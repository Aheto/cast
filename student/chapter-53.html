<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 54 ‚Äî Consonant Digraph sh"/>
  <title>Mini OpenStax ‚Äî Lesson 54: Consonant Digraph sh</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 54: Consonant Digraph sh</h1>
        <div class="lo-tags" id="lo-tags">LO PH54: Decode words with consonant digraph /sh/</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Consonant digraph <strong>sh</strong> words:</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      const currentChapter = 53; // chapter-53.html = Lesson 54
      const maxChapter = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 54: Consonant Digraph sh",
        loTags: ["LO PH54: Decode words with consonant digraph /sh/"],
        contentWords: [
          "dish", "fish", "wish", "swish", "mesh", "flesh", "fresh", "rush", "hush", "gush",
          "mush", "lush", "brush", "crush", "blush", "flush", "plush", "shush", "josh", "slosh"
        ],
        sentences: [
          "Milt set the fresh fish on a dish.",
          "Did the cat wish it had the fish?",
          "Fran must rush and get on the bus.",
          "The man let the gas gush from the gas can.",
          "Jim let the wet rag swish and slosh in the dish.",
          "Josh got mud on the plush rug in the den.",
          "Did Josh blush? Did Josh get red?",
          "Josh can get a scrub brush and scrub up the mud."
        ],
        assessmentItems: [
          { id: "1", prompt: "Which word begins with the /sh/ sound but is spelled with 'sh'?", options: [{id:"a",text:"dish",is_correct:true},{id:"b",text:"cat",is_correct:false},{id:"c",text:"bus",is_correct:false},{id:"d",text:"gas",is_correct:false}] },
          { id: "2", prompt: "Which word means 'to move quickly, often in a hurry'?", options: [{id:"a",text:"rush",is_correct:true},{id:"b",text:"gush",is_correct:false},{id:"c",text:"slosh",is_correct:false},{id:"d",text:"swish",is_correct:false}] },
          { id: "3", prompt: "How many letters in 'brush'?", options: [{id:"a",text:"5",is_correct:true},{id:"b",text:"4",is_correct:false},{id:"c",text:"6",is_correct:false},{id:"d",text:"3",is_correct:false}] },
          { id: "4", prompt: "Which word describes something soft, thick, and expensive (like a carpet)?", options: [{id:"a",text:"plush",is_correct:true},{id:"b",text:"lush",is_correct:true},{id:"c",text:"fresh",is_correct:false},{id:"d",text:"Both A and B",is_correct:true}] },
          { id: "5", prompt: "Which sentence is from Lesson 54?", options: [{id:"a",text:"Josh can get a scrub brush and scrub up the mud.",is_correct:true},{id:"b",text:"She likes apples.",is_correct:false},{id:"c",text:"He flew a kite.",is_correct:false},{id:"d",text:"They played soccer.",is_correct:false}] },
          { id: "6", prompt: "Which word rhymes with 'dish'?", options: [{id:"a",text:"fish",is_correct:true},{id:"b",text:"wish",is_correct:true},{id:"c",text:"swish",is_correct:true},{id:"d",text:"All of the above",is_correct:true}] },
          { id: "7", prompt: "What syllable type is 'mush'?", options: [{id:"a",text:"Closed syllable",is_correct:true},{id:"b",text:"Open syllable",is_correct:false},{id:"c",text:"Magic E",is_correct:false},{id:"d",text:"Vowel team",is_correct:false}] },
          { id: "8", prompt: "In 'Jim let the wet rag swish and slosh in the dish', how many /sh/ words?", options: [{id:"a",text:"3 (swish, slosh, dish)",is_correct:true},{id:"b",text:"2",is_correct:false},{id:"c",text:"1",is_correct:false},{id:"d",text:"0",is_correct:false}] },
          { id: "9", prompt: "Which word might complete: 'Please ___! The baby is sleeping.'?", options: [{id:"a",text:"hush",is_correct:true},{id:"b",text:"rush",is_correct:false},{id:"c",text:"gush",is_correct:false},{id:"d",text:"crush",is_correct:false}] },
          { id: "10", prompt: "Which word means 'to squeeze with force until broken'?", options: [{id:"a",text:"crush",is_correct:true},{id:"b",text:"brush",is_correct:false},{id:"c",text:"flush",is_correct:false},{id:"d",text:"blush",is_correct:false}] },
          { id: "11", prompt: "Which proper name appears in sentences 6, 7, and 8?", options: [{id:"a",text:"Josh",is_correct:true},{id:"b",text:"Milt",is_correct:false},{id:"c",text:"Fran",is_correct:false},{id:"d",text:"Jim",is_correct:false}] },
          { id: "12", prompt: "How many unique /sh/ words are in the word list?", options: [{id:"a",text:"20",is_correct:true},{id:"b",text:"18",is_correct:false},{id:"c",text:"15",is_correct:false},{id:"d",text:"22",is_correct:false}] },
          { id: "13", prompt: "Which word describes turning red in the face from embarrassment?", options: [{id:"a",text:"blush",is_correct:true},{id:"b",text:"flush",is_correct:true},{id:"c",text:"rush",is_correct:false},{id:"d",text:"Both A and B",is_correct:true}] },
          { id: "14", prompt: "Which word appears in sentence 1 AND sentence 5?", options: [{id:"a",text:"dish",is_correct:true},{id:"b",text:"fish",is_correct:false},{id:"c",text:"fresh",is_correct:false},{id:"d",text:"rag",is_correct:false}] },
          { id: "15", prompt: "Which word might complete: 'The waterfall made the river ___.'?", options: [{id:"a",text:"gush",is_correct:true},{id:"b",text:"hush",is_correct:false},{id:"c",text:"mush",is_correct:false},{id:"d",text:"wish",is_correct:false}] },
          { id: "16", prompt: "What phonics feature is in 'slosh'?", options: [{id:"a",text:"Consonant digraph /sh/ in closed syllable",is_correct:true},{id:"b",text:"Vowel team",is_correct:false},{id:"c",text:"Magic E",is_correct:false},{id:"d",text:"R-controlled vowel",is_correct:false}] },
          { id: "17", prompt: "The sentence 'Fran must rush and get on the bus' reviews which earlier concept?", options: [{id:"a",text:"Sight word 'must' (from Lesson 38)",is_correct:true},{id:"b",text:"Short u (/≈≠/)",is_correct:true},{id:"c",text:"Long vowels",is_correct:false},{id:"d",text:"Silent letters",is_correct:false}] },
          { id: "18", prompt: "Which word is NOT in the Lesson 54 word list?", options: [{id:"a",text:"can",is_correct:true},{id:"b",text:"dish",is_correct:false},{id:"c",text:"brush",is_correct:false},{id:"d",text:"slosh",is_correct:false}] },
          { id: "19", prompt: "Which word combines /j/ and /sh/?", options: [{id:"a",text:"josh",is_correct:true},{id:"b",text:"gush",is_correct:false},{id:"c",text:"lush",is_correct:false},{id:"d",text:"mush",is_correct:false}] },
          { id: "20", prompt: "What phonics concept is taught in Lesson 54?", options: [{id:"a",text:"Consonant digraph /sh/ in closed syllables",is_correct:true},{id:"b",text:"Consonant blends",is_correct:false},{id:"c",text:"Vowel digraphs",is_correct:false},{id:"d",text:"Silent letters",is_correct:false}] }
        ]
      };

      // --- UI Rendering ---
      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        // Fix spacing: "f resh" ‚Üí "fresh"
        const cleanSentences = CHAPTER_CONFIG.sentences.map(s => s.replace(/f resh/g, 'fresh'));
        document.getElementById('sentences').innerHTML =
          cleanSentences.map(s => `<p>${s}</p>`).join('');
      }

      // ‚úÖ NAVIGATION: 5 buttons ‚Äî Home + Lesson 54 to 57
      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];

        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i; // c = 53,54,55,56
          const lessonNum = c + 1;      // Lesson 54,55,56,57
          if (c > maxChapter) break;
          buttons.push({ 
            label: `Lesson ${lessonNum}`, 
            url: `chapter-${c}.html`, 
            active: i === 0 
          });
        }

        nav.innerHTML = buttons.map(b => 
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const opts = shuffle([...q.options]);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;
          const optHtml = opts.map((o, i) => {
            const L = String.fromCharCode(65 + i);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${o.id}" required> ${L}. ${o.text}</label></div>`;
          }).join('');
          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attemptsKey = `quiz_attempts_${currentChapter}`;
        const attempts = (parseInt(localStorage.getItem(attemptsKey)) || 0) + 1;
        localStorage.setItem(attemptsKey, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        const reportKey = `saved_report_${currentChapter}_${Date.now()}`;
        localStorage.setItem(reportKey, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the /sh/ digraph!' :
              score >= 10 ? 'Review missed items.' : 'Practice Lesson 54 words again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = saveName;
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = saveName;
        }

        function saveName() {
          const name = input.value.trim();
          if (name) {
            localStorage.setItem('student_name', name);
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          } else {
            alert("Please enter your name.");
            input.focus();
          }
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
