<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 25 ‚Äî Consonant Blend pr"/>
  <title>Mini OpenStax ‚Äî Lesson 25: Consonant Blend pr</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 25: Consonant Blend pr</h1>
        <div class="lo-tags" id="lo-tags">LO PH25: Decode words with consonant blend /pr/</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Consonant blend <strong>pr</strong> words:</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      const currentChapter = 24; // chapter-24.html = Lesson 25
      const maxChapter = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 25: Consonant Blend pr",
        loTags: ["LO PH25: Decode words with consonant blend /pr/"],
        contentWords: [
          "prop", "prom", "prod", "prep", "prim"
        ],
        sentences: [
          "Did the cat prod the crab?",
          "Did the crab jab at the cat?",
          "Did the dog prod the frog?",
          "Did the frog hop up on the dog?",
          "A prim man sat on the bus.",
          "Prim Pam sat at the prom.",
          "A log can prop up a hut."
        ],
        assessmentItems: [
          { id: "1", prompt: "Which word begins with the /pr/ blend?", options: [{id:"a",text:"prop",is_correct:true},{id:"b",text:"hop",is_correct:false},{id:"c",text:"cat",is_correct:false},{id:"d",text:"dog",is_correct:false}] },
          { id: "2", prompt: "Which word means 'to push or poke something sharply'?", options: [{id:"a",text:"prod",is_correct:true},{id:"b",text:"prop",is_correct:false},{id:"c",text:"prom",is_correct:false},{id:"d",text:"prep",is_correct:false}] },
          { id: "3", prompt: "How many letters in 'prim'?", options: [{id:"a",text:"4",is_correct:true},{id:"b",text:"3",is_correct:false},{id:"c",text:"5",is_correct:false},{id:"d",text:"2",is_correct:false}] },
          { id: "4", prompt: "Which word describes someone neat, proper, or stiff in behavior?", options: [{id:"a",text:"prim",is_correct:true},{id:"b",text:"prod",is_correct:false},{id:"c",text:"prop",is_correct:false},{id:"d",text:"prep",is_correct:false}] },
          { id: "5", prompt: "Which sentence is from Lesson 25?", options: [{id:"a",text:"Prim Pam sat at the prom.",is_correct:true},{id:"b",text:"She likes apples.",is_correct:false},{id:"c",text:"He flew a kite.",is_correct:false},{id:"d",text:"They played soccer.",is_correct:false}] },
          { id: "6", prompt: "Which word rhymes with 'mom'?", options: [{id:"a",text:"prom",is_correct:true},{id:"b",text:"prod",is_correct:false},{id:"c",text:"prop",is_correct:false},{id:"d",text:"prep",is_correct:false}] },
          { id: "7", prompt: "What syllable type is 'prod'?", options: [{id:"a",text:"Closed syllable",is_correct:true},{id:"b",text:"Open syllable",is_correct:false},{id:"c",text:"Magic E",is_correct:false},{id:"d",text:"Vowel team",is_correct:false}] },
          { id: "8", prompt: "In 'Did the cat prod the crab?', how many /pr/ words?", options: [{id:"a",text:"1",is_correct:true},{id:"b",text:"2",is_correct:false},{id:"c",text:"0",is_correct:false},{id:"d",text:"3",is_correct:false}] },
          { id: "9", prompt: "Which word might complete: 'Use a stick to ___ the fire.'?", options: [{id:"a",text:"prod",is_correct:true},{id:"b",text:"prom",is_correct:false},{id:"c",text:"prim",is_correct:false},{id:"d",text:"hop",is_correct:false}] },
          { id: "10", prompt: "Which word means 'to support or hold something up'?", options: [{id:"a",text:"prop",is_correct:true},{id:"b",text:"prod",is_correct:false},{id:"c",text:"prom",is_correct:false},{id:"d",text:"prep",is_correct:false}] },
          { id: "11", prompt: "Which word refers to a formal dance for high school students?", options: [{id:"a",text:"prom",is_correct:true},{id:"b",text:"prop",is_correct:false},{id:"c",text:"prod",is_correct:false},{id:"d",text:"prim",is_correct:false}] },
          { id: "12", prompt: "Which word might complete: 'She is very ___ and always sits up straight.'?", options: [{id:"a",text:"prim",is_correct:true},{id:"b",text:"prod",is_correct:false},{id:"c",text:"prop",is_correct:false},{id:"d",text:"hop",is_correct:false}] },
          { id: "13", prompt: "Which sentence includes the word 'prop'?", options: [{id:"a",text:"A log can prop up a hut.",is_correct:true},{id:"b",text:"Prim Pam sat at the prom.",is_correct:false},{id:"c",text:"Did the cat prod the crab?",is_correct:false},{id:"d",text:"Did the dog prod the frog?",is_correct:false}] },
          { id: "14", prompt: "How many /pr/ words in: 'Prim Pam sat at the prom.'?", options: [{id:"a",text:"2",is_correct:true},{id:"b",text:"1",is_correct:false},{id:"c",text:"0",is_correct:false},{id:"d",text:"3",is_correct:false}] },
          { id: "15", prompt: "Which word might complete: 'Before the test, she did some ___ work.'?", options: [{id:"a",text:"prep",is_correct:true},{id:"b",text:"prod",is_correct:false},{id:"c",text:"prom",is_correct:false},{id:"d",text:"prim",is_correct:false}] },
          { id: "16", prompt: "What phonics feature is in 'prep'?", options: [{id:"a",text:"Consonant blend /pr/ in closed syllable",is_correct:true},{id:"b",text:"Vowel team",is_correct:false},{id:"c",text:"Magic E",is_correct:false},{id:"d",text:"R-controlled vowel",is_correct:false}] },
          { id: "17", prompt: "The sentence 'Did the frog hop up on the dog?' reviews which earlier concept?", options: [{id:"a",text:"Consonant blend /fr/ (from Lesson 24)",is_correct:true},{id:"b",text:"Short o (/≈è/)",is_correct:true},{id:"c",text:"Long vowels",is_correct:false},{id:"d",text:"Silent letters",is_correct:false}] },
          { id: "18", prompt: "Which word is NOT a /pr/ word?", options: [{id:"a",text:"frog",is_correct:true},{id:"b",text:"prop",is_correct:false},{id:"c",text:"prod",is_correct:false},{id:"d",text:"prom",is_correct:false}] },
          { id: "19", prompt: "Which word appears in both the word list and a sentence?", options: [{id:"a",text:"prod",is_correct:true},{id:"b",text:"prop",is_correct:true},{id:"c",text:"prim",is_correct:true},{id:"d",text:"All of the above",is_correct:true}] },
          { id: "20", prompt: "What phonics concept is taught in Lesson 25?", options: [{id:"a",text:"Consonant blend /pr/ in closed syllables",is_correct:true},{id:"b",text:"Short u",is_correct:false},{id:"c",text:"Vowel digraphs",is_correct:false},{id:"d",text:"Silent letters",is_correct:false}] }
        ]
      };

      // --- UI Rendering ---
      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        document.getElementById('sentences').innerHTML =
          CHAPTER_CONFIG.sentences.map(s => `<p>${s}</p>`).join('');
      }

      // ‚úÖ NAVIGATION: 5 buttons ‚Äî Home + Lesson 25 to 28
      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];

        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i; // c = 24,25,26,27
          const lessonNum = c + 1;      // Lesson 25,26,27,28
          if (c > maxChapter) break;
          buttons.push({ 
            label: `Lesson ${lessonNum}`, 
            url: `chapter-${c}.html`, 
            active: i === 0 
          });
        }

        nav.innerHTML = buttons.map(b => 
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const opts = shuffle([...q.options]);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;
          const optHtml = opts.map((o, i) => {
            const L = String.fromCharCode(65 + i);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${o.id}" required> ${L}. ${o.text}</label></div>`;
          }).join('');
          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attemptsKey = `quiz_attempts_${currentChapter}`;
        const attempts = (parseInt(localStorage.getItem(attemptsKey)) || 0) + 1;
        localStorage.setItem(attemptsKey, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        const reportKey = `saved_report_${currentChapter}_${Date.now()}`;
        localStorage.setItem(reportKey, report);

        // Fixed WhatsApp URL (no space after wa.me/)
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the /pr/ blend!' :
              score >= 10 ? 'Review missed items.' : 'Practice Lesson 25 words again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = saveName;
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = saveName;
        }

        function saveName() {
          const name = input.value.trim();
          if (name) {
            localStorage.setItem('student_name', name);
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          } else {
            alert("Please enter your name.");
            input.focus();
          }
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
