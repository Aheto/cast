<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 71: Consonant x"/>
  <title>Mini OpenStax ‚Äî Lesson 71: Consonant x</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 71: Consonant x</h1>
        <div class="lo-tags" id="lo-tags">LO PH71: Decode words with consonant /x/</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Practice reading words with the consonant <strong>x</strong> (which makes the /ks/ sound):</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      const currentChapter = 70; // chapter-70.html = Lesson 71
      const maxChapter = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 71: Consonant x",
        loTags: ["LO PH71: Decode words with consonant /x/"],
        contentWords: [
          "ax", "fax", "lax", "Max", "sax", "tax", "wax", "Rex", "Tex", "vex",
          "flex", "next", "text", "fix", "mix", "nix", "six", "sixth", "ox", "box",
          "fox", "pox", "flux"
        ],
        sentences: [
          "Max got a f ax from Rick.",
          "Matt can chop up the log with an ax.",
          "A f ox can catch a hen and a chick.",
          "A f ox can snatch an egg from a nest.",
          "Rex did well on the next math quiz.",
          "Rex got a gift in a box from Mom.",
          "A man at the ranch kept an ox in a pen.",
          "Did the bug buzz at Max? Did the bug vex Max?",
          "The shop can fix the fan belt on the truck.",
          "Tex will wax the truck and buff the wax with a soft cloth."
        ],
        assessmentItems: [
          { id: "1", prompt: "Which sentence contains a typo that needs correction?", options: [
            {id:"a",text:"Sentence 1: 'f ax'",is_correct:true},
            {id:"b",text:"Sentence 3: 'f ox'",is_correct:true},
            {id:"c",text:"Sentence 4: 'f ox'",is_correct:true},
            {id:"d",text:"Sentence 10: 'wax'",is_correct:false}
          ]},
          // Choose one for clarity
          { id: "1", prompt: "Which sentence contains the typo 'f ax'?", options: [
            {id:"a",text:"Sentence 1",is_correct:true},
            {id:"b",text:"Sentence 2",is_correct:false},
            {id:"c",text:"Sentence 5",is_correct:false},
            {id:"d",text:"Sentence 10",is_correct:false}
          ]},
          { id: "2", prompt: "After correction, 'f ax' becomes:", options: [
            {id:"a",text:"fax",is_correct:true},
            {id:"b",text:"fix",is_correct:false},
            {id:"c",text:"fox",is_correct:false},
            {id:"d",text:"faxs",is_correct:false}
          ]},
          { id: "3", prompt: "What does 'vex' mean?", options: [
            {id:"a",text:"To please",is_correct:false},
            {id:"b",text:"To annoy or irritate",is_correct:true},
            {id:"c",text:"To fix",is_correct:false},
            {id:"d",text:"To shout",is_correct:false}
          ]},
          { id: "4", prompt: "Which word is a proper name?", options: [
            {id:"a",text:"Max",is_correct:true},
            {id:"b",text:"box",is_correct:false},
            {id:"c",text:"wax",is_correct:false},
            {id:"d",text:"tax",is_correct:false}
          ]},
          { id: "5", prompt: "What sound does 'x' usually make at the end of a word?", options: [
            {id:"a",text:"/z/",is_correct:false},
            {id:"b",text:"/ks/",is_correct:true},
            {id:"c",text:"/gz/",is_correct:false},
            {id:"d",text:"/s/",is_correct:false}
          ]},
          { id: "6", prompt: "Which sentence includes a repair action?", options: [
            {id:"a",text:"Sentence 9",is_correct:true},
            {id:"b",text:"Sentence 1",is_correct:false},
            {id:"c",text:"Sentence 7",is_correct:false},
            {id:"d",text:"Sentence 10",is_correct:false}
          ]},
          { id: "7", prompt: "What is an 'ox'?", options: [
            {id:"a",text:"A type of bird",is_correct:false},
            {id:"b",text:"A large, strong bovine animal",is_correct:true},
            {id:"c",text:"A wild cat",is_correct:false},
            {id:"d",text:"A machine",is_correct:false}
          ]},
          { id: "8", prompt: "Which sentence mentions a gift?", options: [
            {id:"a",text:"Sentence 6",is_correct:true},
            {id:"b",text:"Sentence 2",is_correct:false},
            {id:"c",text:"Sentence 4",is_correct:false},
            {id:"d",text:"Sentence 8",is_correct:false}
          ]},
          { id: "9", prompt: "Which word means 'to combine'?", options: [
            {id:"a",text:"mix",is_correct:true},
            {id:"b",text:"nix",is_correct:false},
            {id:"c",text:"lax",is_correct:false},
            {id:"d",text:"flux",is_correct:false}
          ]},
          { id: "10", prompt: "What does 'wax' mean in sentence 10?", options: [
            {id:"a",text:"To grow",is_correct:false},
            {id:"b",text:"To apply a protective polish",is_correct:true},
            {id:"c",text:"To shine",is_correct:false},
            {id:"d",text:"To melt",is_correct:false}
          ]},
          { id: "11", prompt: "Which sentence includes a character from past lessons?", options: [
            {id:"a",text:"Sentence 1: Rick",is_correct:true},
            {id:"b",text:"Sentence 2: Matt",is_correct:true},
            {id:"c",text:"Sentence 5: Rex",is_correct:false},
            {id:"d",text:"Sentence 10: Tex",is_correct:false}
          ]},
          // Choose one recurring
          { id: "11", prompt: "Which character appeared in Lessons 63, 64, and 65?", options: [
            {id:"a",text:"Rick",is_correct:true},
            {id:"b",text:"Matt",is_correct:false},
            {id:"c",text:"Rex",is_correct:false},
            {id:"d",text:"Tex",is_correct:false}
          ]},
          { id: "12", prompt: "Which word refers to a musical instrument?", options: [
            {id:"a",text:"sax",is_correct:true},
            {id:"b",text:"fax",is_correct:false},
            {id:"c",text:"box",is_correct:false},
            {id:"d",text:"wax",is_correct:false}
          ]},
          { id: "13", prompt: "What does 'nix' mean?", options: [
            {id:"a",text:"To approve",is_correct:false},
            {id:"b",text:"To reject or cancel",is_correct:true},
            {id:"c",text:"To build",is_correct:false},
            {id:"d",text:"To sell",is_correct:false}
          ]},
          { id: "14", prompt: "Which sentence includes two 'x' words?", options: [
            {id:"a",text:"Sentence 10",is_correct:true},
            {id:"b",text:"Sentence 1",is_correct:false},
            {id:"c",text:"Sentence 5",is_correct:false},
            {id:"d",text:"Sentence 8",is_correct:false}
          ]},
          { id: "15", prompt: "How many 'x' words appear in sentence 1 after correction?", options: [
            {id:"a",text:"1",is_correct:true},
            {id:"b",text:"2",is_correct:false},
            {id:"c",text:"0",is_correct:false},
            {id:"d",text:"3",is_correct:false}
          ]},
          { id: "16", prompt: "Which word is NOT in the Lesson 71 word list?", options: [
            {id:"a",text:"sixth",is_correct:false},
            {id:"b",text:"pox",is_correct:false},
            {id:"c",text:"peck",is_correct:true},
            {id:"d",text:"flux",is_correct:false}
          ]},
          { id: "17", prompt: "Which phrase uses an 'x' word correctly?", options: [
            {id:"a",text:"She sent a fax.",is_correct:true},
            {id:"b",text:"He ate a big wax for lunch.",is_correct:false},
            {id:"c",text:"They drove a fox to school.",is_correct:false},
            {id:"d",text:"The dog gave a sax of joy.",is_correct:false}
          ]},
          { id: "18", prompt: "Which word is an ordinal number?", options: [
            {id:"a",text:"six",is_correct:false},
            {id:"b",text:"sixth",is_correct:true},
            {id:"c",text:"next",is_correct:false},
            {id:"d",text:"text",is_correct:false}
          ]},
          { id: "19", prompt: "Which sentence describes a predator-prey relationship?", options: [
            {id:"a",text:"Sentence 3",is_correct:true},
            {id:"b",text:"Sentence 6",is_correct:false},
            {id:"c",text:"Sentence 7",is_correct:false},
            {id:"d",text:"Sentence 9",is_correct:false}
          ]},
          { id: "20", prompt: "What is the phonetic composition of the letter 'x' at the end of words like 'box' and 'fix'?", options: [
            {id:"a",text:"/k/ + /s/",is_correct:true},
            {id:"b",text:"/g/ + /z/",is_correct:false},
            {id:"c",text:"/ks/ as a single sound",is_correct:false},
            {id:"d",text:"Silent",is_correct:false}
          ]}
        ]
      };

      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        let sentences = CHAPTER_CONFIG.sentences.map(s => 
          s.replace(/f resh/g, 'fresh')
           .replace(/p unch/g, 'punch')
           .replace(/slep t/g, 'slept')
           .replace(/crep t/g, 'crept')
           .replace(/p lant/g, 'plant')
           .replace(/f ax/g, 'fax')
           .replace(/f ox/g, 'fox')
        );
        document.getElementById('sentences').innerHTML =
          sentences.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > maxChapter) break;
          buttons.push({ 
            label: `Lesson ${lessonNum}`, 
            url: `chapter-${c}.html`, 
            active: i === 0 
          });
        }
        nav.innerHTML = buttons.map(b => 
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const opts = shuffle([...q.options]);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;
          const optHtml = opts.map((o, i) => {
            const L = String.fromCharCode(65 + i);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${o.id}" required> ${L}. ${o.text}</label></div>`;
          }).join('');
          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attemptsKey = `quiz_attempts_${currentChapter}`;
        const attempts = (parseInt(localStorage.getItem(attemptsKey)) || 0) + 1;
        localStorage.setItem(attemptsKey, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        const reportKey = `saved_report_${currentChapter}_${Date.now()}`;
        localStorage.setItem(reportKey, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the /x/ pattern!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = saveName;
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = saveName;
        }

        function saveName() {
          const name = input.value.trim();
          if (name) {
            localStorage.setItem('student_name', name);
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          } else {
            alert("Please enter your name.");
            input.focus();
          }
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
