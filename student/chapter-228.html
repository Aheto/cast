<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 229: 'a' = /≈è/"/>
  <title>Mini OpenStax ‚Äî Lesson 229: 'a' = /≈è/</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 229: 'a' = /≈è/</h1>
        <div class="lo-tags" id="lo-tags">LO PH229: Decode words where 'a' makes the /≈è/ sound as in 'want'</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Words where 'a' is pronounced as /≈è/ (like 'want', 'swan').</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const currentChapter = 228;
      const MAX_CHAPTER = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 229: 'a' = /≈è/",
        loTags: ["LO PH229: Decode words where 'a' makes the /≈è/ sound as in 'want'"],
        contentWords: [
          "want", "wand", "wash", "wasp", "watch", "water", "wander", "waffle", "swan", "swat",
          "swap", "swamp", "quantity", "squat", "squash", "squabble"
        ],
        sentences: [
          "Joe can swap his old bike for a new one.",
          "Earl doesn't want to be late for his class.",
          "Earl should check his watch to see what time it is.",
          "At the park, Jane saw a swan swimming in the pond.",
          "The two little boys began to squabble over the toy.",
          "Walter tried to swat the wasp before it could sting him.",
          "Mike must wash his face with soap and water before he goes to bed.",
          "A parent must make sure that a small child does not wander off and get lost."
        ],
        assessmentItems: [
          { id: "1", prompt: "Which word means 'to desire something'?", options: [{id:"a",text:"want",is_correct:true},{id:"b",text:"wand",is_correct:false},{id:"c",text:"wash",is_correct:false},{id:"d",text:"wasp",is_correct:false}]},
          { id: "2", prompt: "Which sentence uses 'swan' correctly?", options: [{id:"a",text:"A swan swam in the lake.",is_correct:true},{id:"b",text:"She swans the water.",is_correct:false},{id:"c",text:"He to swan today.",is_correct:false},{id:"d",text:"Swan is only a verb.",is_correct:false}]},
          { id: "3", prompt: "What does 'squabble' mean?", options: [{id:"a",text:"to argue noisily",is_correct:true},{id:"b",text:"to agree",is_correct:false},{id:"c",text:"to share",is_correct:false},{id:"d",text:"to sleep",is_correct:false}]},
          { id: "4", prompt: "Which word means 'to strike with a quick motion'?", options: [{id:"a",text:"swat",is_correct:true},{id:"b",text:"swap",is_correct:false},{id:"c",text:"swamp",is_correct:false},{id:"d",text:"squat",is_correct:false}]},
          { id: "5", prompt: "Choose the correct spelling:", options: [{id:"a",text:"squash",is_correct:true},{id:"b",text:"squashh",is_correct:false},{id:"c",text:"squosh",is_correct:false},{id:"d",text:"squash",is_correct:false}]},
          { id: "6", prompt: "Which word is NOT pronounced with /≈è/ for 'a'?", options: [{id:"a",text:"water",is_correct:true},{id:"b",text:"want",is_correct:false},{id:"c",text:"wash",is_correct:false},{id:"d",text:"wasp",is_correct:false}]},
          { id: "7", prompt: "Which word rhymes with 'swat'?", options: [{id:"a",text:"want",is_correct:false},{id:"b",text:"watch",is_correct:true},{id:"c",text:"wander",is_correct:false},{id:"d",text:"waffle",is_correct:false}]},
          { id: "8", prompt: "Which sentence uses 'wander' correctly?", options: [{id:"a",text:"The child wandered through the woods.",is_correct:true},{id:"b",text:"She wanders yesterday.",is_correct:false},{id:"c",text:"He to wander now.",is_correct:false},{id:"d",text:"Wandering are fun.",is_correct:false}]},
          { id: "9", prompt: "What is a 'wasp'?", options: [{id:"a",text:"a stinging insect",is_correct:true},{id:"b",text:"a bird",is_correct:false},{id:"c",text:"a fish",is_correct:false},{id:"d",text:"a plant",is_correct:false}]},
          { id: "10", prompt: "Which word means 'to exchange one thing for another'?", options: [{id:"a",text:"swap",is_correct:true},{id:"b",text:"swamp",is_correct:false},{id:"c",text:"squat",is_correct:false},{id:"d",text:"squash",is_correct:false}]},
          { id: "11", prompt: "Which is spelled correctly?", options: [{id:"a",text:"waffle",is_correct:true},{id:"b",text:"wafle",is_correct:false},{id:"c",text:"woffle",is_correct:false},{id:"d",text:"wouffle",is_correct:false}]},
          { id: "12", prompt: "Choose the word that means 'a wetland full of trees':", options: [{id:"a",text:"swamp",is_correct:true},{id:"b",text:"swan",is_correct:false},{id:"c",text:"swat",is_correct:false},{id:"d",text:"swap",is_correct:false}]},
          { id: "13", prompt: "Which word describes crouching low to the ground?", options: [{id:"a",text:"squat",is_correct:true},{id:"b",text:"squash",is_correct:false},{id:"c",text:"squabble",is_correct:false},{id:"d",text:"swamp",is_correct:false}]},
          { id: "14", prompt: "In which word is 'a' NOT pronounced /≈è/?", options: [{id:"a",text:"water",is_correct:true},{id:"b",text:"want",is_correct:false},{id:"c",text:"wash",is_correct:false},{id:"d",text:"watch",is_correct:false}]},
          { id: "15", prompt: "What does 'quantity' mean?", options: [{id:"a",text:"an amount or number",is_correct:true},{id:"b",text:"a type of bird",is_correct:false},{id:"c",text:"a loud noise",is_correct:false},{id:"d",text:"a color",is_correct:false}]},
          { id: "16", prompt: "Which word fits: 'He used a _____ to clean his hands.'", options: [{id:"a",text:"wash",is_correct:true},{id:"b",text:"wasp",is_correct:false},{id:"c",text:"wand",is_correct:false},{id:"d",text:"waffle",is_correct:false}]},
          { id: "17", prompt: "Which word means 'a magical stick'?", options: [{id:"a",text:"wand",is_correct:true},{id:"b",text:"wasp",is_correct:false},{id:"c",text:"watch",is_correct:false},{id:"d",text:"water",is_correct:false}]},
          { id: "18", prompt: "Which sentence is correct?", options: [{id:"a",text:"She watches the clock.",is_correct:true},{id:"b",text:"He watch yesterday.",is_correct:false},{id:"c",text:"They to watch TV.",is_correct:false},{id:"d",text:"Watching are fun.",is_correct:false}]},
          { id: "19", prompt: "Which word contains 'a' = /≈è/ and means 'to flatten by pressure'?", options: [{id:"a",text:"squash",is_correct:true},{id:"b",text:"squat",is_correct:false},{id:"c",text:"swap",is_correct:false},{id:"d",text:"swamp",is_correct:false}]},
          { id: "20", prompt: "Which word means 'a device for telling time'?", options: [{id:"a",text:"watch",is_correct:true},{id:"b",text:"wand",is_correct:false},{id:"c",text:"wasp",is_correct:false},{id:"d",text:"waffle",is_correct:false}]}
        ]
      };

      const TYPO_CORRECTIONS = [
        [/w ant/g, 'want'], [/w and/g, 'wand'], [/w ash/g, 'wash'], [/w asp/g, 'wasp'],
        [/w atch/g, 'watch'], [/w ater/g, 'water'], [/w ander/g, 'wander'], [/w affle/g, 'waffle'],
        [/s wan/g, 'swan'], [/s wat/g, 'swat'], [/s wap/g, 'swap'], [/s wamp/g, 'swamp'],
        [/q uantity/g, 'quantity'], [/s quat/g, 'squat'], [/s quash/g, 'squash'], [/s quabble/g, 'squabble']
      ];

      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        const corrected = CHAPTER_CONFIG.sentences.map(s => {
          let text = s;
          TYPO_CORRECTIONS.forEach(([pattern, replacement]) => {
            text = text.replace(pattern, replacement);
          });
          return text;
        });
        document.getElementById('sentences').innerHTML =
          corrected.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);
        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;
          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');
          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];
        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });
        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';
        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;
        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');
        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
