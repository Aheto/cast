<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 89: ea=/ƒì/"/>
  <title>Mini OpenStax ‚Äî Lesson 89: ea=/ƒì/</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 89: ea=/ƒì/</h1>
        <div class="lo-tags" id="lo-tags">LO PH089: Decode words with vowel team "ea" pronounced /ƒì/</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Words with "ea" that say /ƒì/ (long e sound):</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const currentChapter = 88;
      const MAX_CHAPTER = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 89: ea=/ƒì/",
        loTags: ["LO PH089: Decode words with vowel team \"ea\" pronounced /ƒì/"],
        contentWords: [
          "pea", "peak", "peal", "peach", "preach", "plea", "plead", "pleat", "read", "real", "ream", "reap", "rear", "reach",
          "tea", "teak", "team", "tear", "teach", "treat", "tweak", "zeal", "weak", "wean", "wheat", "year", "yeast", "veal"
        ],
        sentences: [
          "Cliff was sick and felt weak.",
          "Neal sat in a rear seat on the bus.",
          "Beth says her team can beat their team.",
          "Ann will help Jeff and teach him to read.",
          "A wisp of steam went up from the hot cup of tea.",
          "Bess will plead with Mom to get the doll at the shop.",
          "Each year, the men on the ranch reap the crop of wheat.",
          "Jill got a deep cut on her heel, but she did not shed a tear.",
          "Max can pluck a sweet peach from the branch of a peach tree.",
          "Frank must plod up the path to reach the peak of the steep hill."
        ],
        assessmentItems: [
          { id: "1", prompt: "Which word has 'ea' that says /ƒì/?", options: [
            {id:"a",text:"head",is_correct:false},
            {id:"b",text:"peach",is_correct:true},
            {id:"c",text:"bread",is_correct:false},
            {id:"d",text:"dead",is_correct:false}
          ]},
          { id: "2", prompt: "Which word means 'to instruct'?", options: [
            {id:"a",text:"teach",is_correct:true},
            {id:"b",text:"tweak",is_correct:false},
            {id:"c",text:"team",is_correct:false},
            {id:"d",text:"tear",is_correct:false}
          ]},
          { id: "3", prompt: "Which word rhymes with 'sea'?", options: [
            {id:"a",text:"pea",is_correct:true},
            {id:"b",text:"pan",is_correct:false},
            {id:"c",text:"pet",is_correct:false},
            {id:"d",text:"pat",is_correct:false}
          ]},
          { id: "4", prompt: "Which word is a hot beverage?", options: [
            {id:"a",text:"tea",is_correct:true},
            {id:"b",text:"treat",is_correct:false},
            {id:"c",text:"team",is_correct:false},
            {id:"d",text:"teak",is_correct:false}
          ]},
          { id: "5", prompt: "Which sentence uses a word with 'ea' = /ƒì/?", options: [
            {id:"a",text:"He ran fast.",is_correct:false},
            {id:"b",text:"Ann will teach Jeff to read.",is_correct:true},
            {id:"c",text:"It is cold.",is_correct:false},
            {id:"d",text:"They played.",is_correct:false}
          ]},
          { id: "6", prompt: "Which word means 'to harvest crops'?", options: [
            {id:"a",text:"reap",is_correct:true},
            {id:"b",text:"read",is_correct:false},
            {id:"c",text:"real",is_correct:false},
            {id:"d",text:"ream",is_correct:false}
          ]},
          { id: "7", prompt: "Which word describes the top of a mountain?", options: [
            {id:"a",text:"peak",is_correct:true},
            {id:"b",text:"peal",is_correct:false},
            {id:"c",text:"peach",is_correct:false},
            {id:"d",text:"plea",is_correct:false}
          ]},
          { id: "8", prompt: "How is 'ea' pronounced in 'weak'?", options: [
            {id:"a",text:"/ƒï/",is_correct:false},
            {id:"b",text:"/ƒì/",is_correct:true},
            {id:"c",text:"/√¶/",is_correct:false},
            {id:"d",text:"/ƒ≠/",is_correct:false}
          ]},
          { id: "9", prompt: "Which word means 'to beg earnestly'?", options: [
            {id:"a",text:"plead",is_correct:true},
            {id:"b",text:"pleat",is_correct:false},
            {id:"c",text:"preach",is_correct:false},
            {id:"d",text:"peal",is_correct:false}
          ]},
          { id: "10", prompt: "Which word comes FIRST alphabetically?", options: [
            {id:"a",text:"pea",is_correct:true},
            {id:"b",text:"peak",is_correct:false},
            {id:"c",text:"peal",is_correct:false},
            {id:"d",text:"peach",is_correct:false}
          ]},
          { id: "11", prompt: "Which word is a type of hardwood?", options: [
            {id:"a",text:"teak",is_correct:true},
            {id:"b",text:"team",is_correct:false},
            {id:"c",text:"tea",is_correct:false},
            {id:"d",text:"tear",is_correct:false}
          ]},
          { id: "12", prompt: "Which word is NOT in the word list?", options: [
            {id:"a",text:"zeal",is_correct:false},
            {id:"b",text:"veal",is_correct:false},
            {id:"c",text:"great",is_correct:true},
            {id:"d",text:"wheat",is_correct:false}
          ]},
          { id: "13", prompt: "In 'Jill did not shed a tear,' what does 'tear' mean?", options: [
            {id:"a",text:"a drop of water from the eye",is_correct:true},
            {id:"b",text:"to rip",is_correct:false},
            {id:"c",text:"a hole",is_correct:false},
            {id:"d",text:"a sound",is_correct:false}
          ]},
          { id: "14", prompt: "Which word means 'genuine or true'?", options: [
            {id:"a",text:"real",is_correct:true},
            {id:"b",text:"read",is_correct:false},
            {id:"c",text:"ream",is_correct:false},
            {id:"d",text:"rear",is_correct:false}
          ]},
          { id: "15", prompt: "Which word has the same vowel sound as 'beach'?", options: [
            {id:"a",text:"each",is_correct:false},
            {id:"b",text:"reach",is_correct:true},
            {id:"c",text:"head",is_correct:false},
            {id:"d",text:"bread",is_correct:false}
          ]},
          { id: "16", prompt: "Which word ends with /m/ and has 'ea' = /ƒì/?", options: [
            {id:"a",text:"team",is_correct:true},
            {id:"b",text:"tear",is_correct:false},
            {id:"c",text:"tea",is_correct:false},
            {id:"d",text:"teak",is_correct:false}
          ]},
          { id: "17", prompt: "What does 'yeast' do in bread?", options: [
            {id:"a",text:"makes it rise",is_correct:true},
            {id:"b",text:"makes it sweet",is_correct:false},
            {id:"c",text:"adds color",is_correct:false},
            {id:"d",text:"makes it sour",is_correct:false}
          ]},
          { id: "18", prompt: "Which word means 'to stop breastfeeding'?", options: [
            {id:"a",text:"wean",is_correct:true},
            {id:"b",text:"weak",is_correct:false},
            {id:"c",text:"wheat",is_correct:false},
            {id:"d",text:"year",is_correct:false}
          ]},
          { id: "19", prompt: "Which word means 'enthusiastic devotion'?", options: [
            {id:"a",text:"zeal",is_correct:true},
            {id:"b",text:"veal",is_correct:false},
            {id:"c",text:"team",is_correct:false},
            {id:"d",text:"treat",is_correct:false}
          ]},
          { id: "20", prompt: "Which word has 'ea' but does NOT say /ƒì/?", options: [
            {id:"a",text:"bread",is_correct:true},
            {id:"b",text:"peach",is_correct:false},
            {id:"c",text:"teach",is_correct:false},
            {id:"d",text:"team",is_correct:false}
          ]}
        ]
      };

      const TYPO_CORRECTIONS = [
        [/f resh/g, 'fresh'], [/p unch/g, 'punch'], [/slep t/g, 'slept'],
        [/crep t/g, 'crept'], [/p lant/g, 'plant'], [/p ath/g, 'path'],
        [/f roth/g, 'froth'], [/p eck/g, 'peck'], [/f luck/g, 'pluck'],
        [/p luck/g, 'pluck'], [/f ling/g, 'fling'], [/p ass/g, 'pass'],
        [/f uss/g, 'fuss'], [/sp ell/g, 'spell'], [/f uzz/g, 'fuzz'],
        [/thef t/g, 'theft'], [/thrif t/g, 'thrift'], [/dep th/g, 'depth'],
        [/fif th/g, 'fifth'], [/st ink/g, 'stink'], [/wr ink/g, 'wring'],
        [/p each/g, 'peach'], [/p eak/g, 'peak'], [/f ee/g, 'fee'], [/f lea/g, 'flea']
      ];

      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        const corrected = CHAPTER_CONFIG.sentences.map(s => {
          let text = s;
          TYPO_CORRECTIONS.forEach(([pattern, replacement]) => {
            text = text.replace(pattern, replacement);
          });
          return text;
        });
        document.getElementById('sentences').innerHTML =
          corrected.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
