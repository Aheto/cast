<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 82: The 'ee' Pattern"/>
  <title>Mini OpenStax ‚Äî Lesson 82: The 'ee' Pattern</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 82: The 'ee' Pattern</h1>
        <div class="lo-tags" id="lo-tags">LO PH82: Decode and read words with the 'ee' vowel team (/ƒì/ sound)</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>These words use <strong>'ee'</strong> to make the long /ƒì/ sound:</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const currentChapter = 81;
      const MAX_CHAPTER = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 82: The 'ee' Pattern",
        loTags: ["LO PH82: Decode and read words with the 'ee' vowel team (/ƒì/ sound)"],
        contentWords: ["see", "sheep", "steep", "sleep", "deep", "keep", "peep", "weep", "beep", "cheep"],
        sentences: [
          "The sheep sleep in the deep pen.",
          "Do not wake the sheep!",
          "The hill is too steep to climb.",
          "Lee sees three sheep.",
          "We keep sheep on our farm.",
          "The baby birds cheep for food.",
          "I hear a beep from the truck.",
          "Do not weep, Lee.",
          "Peep! Peep! The chicks call.",
          "See the steep hill!"
        ],
        assessmentItems: [
          { id: "1", prompt: "What sound does 'ee' make in 'sheep'?", options: [
            {id:"a",text:"/√¶/",is_correct:false},{id:"b",text:"/e/",is_correct:false},{id:"c",text:"/ƒì/",is_correct:true},{id:"d",text:"/i/",is_correct:false}
          ]},
          { id: "2", prompt: "Which word is spelled correctly?", options: [
            {id:"a",text:"sheap",is_correct:false},{id:"b",text:"sheep",is_correct:true},{id:"c",text:"shiep",is_correct:false},{id:"d",text:"shyp",is_correct:false}
          ]},
          { id: "3", prompt: "Which word means 'to rest with eyes closed'?", options: [
            {id:"a",text:"steep",is_correct:false},{id:"b",text:"sleep",is_correct:true},{id:"c",text:"peep",is_correct:false},{id:"d",text:"weep",is_correct:false}
          ]},
          { id: "4", prompt: "Which word rhymes with 'deep'?", options: [
            {id:"a",text:"dip",is_correct:false},{id:"b",text:"keep",is_correct:true},{id:"c",text:"dop",is_correct:false},{id:"d",text:"tap",is_correct:false}
          ]},
          { id: "5", prompt: "Which sentence uses 'steep' correctly?", options: [
            {id:"a",text:"The soup is steep.",is_correct:false},{id:"b",text:"The hill is steep.",is_correct:true},{id:"c",text:"He steeped his tea.",is_correct:false},{id:"d",text:"She steeped on the grass.",is_correct:false}
          ]},
          { id: "6", prompt: "What does 'weep' mean?", options: [
            {id:"a",text:"To laugh",is_correct:false},{id:"b",text:"To cry",is_correct:true},{id:"c",text:"To sleep",is_correct:false},{id:"d",text:"To jump",is_correct:false}
          ]},
          { id: "7", prompt: "Which word is a sound made by a bird?", options: [
            {id:"a",text:"beep",is_correct:false},{id:"b",text:"cheep",is_correct:true},{id:"c",text:"peep",is_correct:false},{id:"d",text:"all of the above",is_correct:true}
          ]},
          { id: "8", prompt: "How many 'ee' words are in: 'See the sheep sleep.'?", options: [
            {id:"a",text:"1",is_correct:false},{id:"b",text:"2",is_correct:false},{id:"c",text:"3",is_correct:true},{id:"d",text:"0",is_correct:false}
          ]},
          { id: "9", prompt: "Which word is NOT in the word list?", options: [
            {id:"a",text:"leap",is_correct:true},{id:"b",text:"keep",is_correct:false},{id:"c",text:"weep",is_correct:false},{id:"d",text:"peep",is_correct:false}
          ]},
          { id: "10", prompt: "Choose the correct spelling:", options: [
            {id:"a",text:"slep",is_correct:false},{id:"b",text:"sleap",is_correct:false},{id:"c",text:"sleep",is_correct:true},{id:"d",text:"slepe",is_correct:false}
          ]},
          { id: "11", prompt: "What part of speech is 'deep' in 'a deep well'?", options: [
            {id:"a",text:"verb",is_correct:false},{id:"b",text:"adjective",is_correct:true},{id:"c",text:"noun",is_correct:false},{id:"d",text:"adverb",is_correct:false}
          ]},
          { id: "12", prompt: "Which word has the same vowel sound as 'see'?", options: [
            {id:"a",text:"sit",is_correct:false},{id:"b",text:"sea",is_correct:true},{id:"c",text:"sad",is_correct:false},{id:"d",text:"sat",is_correct:false}
          ]},
          { id: "13", prompt: "Which sentence has a typo?", options: [
            {id:"a",text:"The sheep sleep.",is_correct:false},{id:"b",text:"Lee sees sheep.",is_correct:false},{id:"c",text:"Do not wep, Lee.",is_correct:true},{id:"d",text:"Peep! Peep!",is_correct:false}
          ]},
          { id: "14", prompt: "How many syllables in 'sheep'?", options: [
            {id:"a",text:"1",is_correct:true},{id:"b",text:"2",is_correct:false},{id:"c",text:"3",is_correct:false},{id:"d",text:"0",is_correct:false}
          ]},
          { id: "15", prompt: "Which 'ee' word means 'to make a short high sound'?", options: [
            {id:"a",text:"beep",is_correct:false},{id:"b",text:"peep",is_correct:false},{id:"c",text:"cheep",is_correct:false},{id:"d",text:"all of the above",is_correct:true}
          ]},
          { id: "16", prompt: "What is the opposite of 'shallow'?", options: [
            {id:"a",text:"wide",is_correct:false},{id:"b",text:"narrow",is_correct:false},{id:"c",text:"deep",is_correct:true},{id:"d",text:"flat",is_correct:false}
          ]},
          { id: "17", prompt: "Which word is a homophone of 'sea'?", options: [
            {id:"a",text:"see",is_correct:true},{id:"b",text:"she",is_correct:false},{id:"c",text:"bee",is_correct:false},{id:"d",text:"tea",is_correct:false}
          ]},
          { id: "18", prompt: "Which word completes: 'Don‚Äôt ___ the baby bird.'?", options: [
            {id:"a",text:"keep",is_correct:false},{id:"b",text:"peep",is_correct:true},{id:"c",text:"weep",is_correct:false},{id:"d",text:"beep",is_correct:false}
          ]},
          { id: "19", prompt: "In 'steep hill,' what kind of syllable is 'steep'?", options: [
            {id:"a",text:"Closed",is_correct:false},{id:"b",text:"Open",is_correct:false},{id:"c",text:"Vowel team",is_correct:true},{id:"d",text:"R-controlled",is_correct:false}
          ]},
          { id: "20", prompt: "Which sentence uses three 'ee' words correctly?", options: [
            {id:"a",text:"See the sheep sleep.",is_correct:true},{id:"b",text:"Keep the deep beep.",is_correct:false},{id:"c",text:"Weep and cheep.",is_correct:false},{id:"d",text:"Peep the steep.",is_correct:false}
          ]}
        ]
      };

      const TYPO_CORRECTIONS = [
        [/f resh/g, 'fresh'], [/p unch/g, 'punch'], [/slep t/g, 'slept'],
        [/crep t/g, 'crept'], [/p lant/g, 'plant'], [/p ath/g, 'path'],
        [/f roth/g, 'froth'], [/p eck/g, 'peck'], [/f luck/g, 'pluck'],
        [/p luck/g, 'pluck'], [/f ling/g, 'fling'], [/p ass/g, 'pass'],
        [/f uss/g, 'fuss'], [/sp ell/g, 'spell'], [/f uzz/g, 'fuzz'],
        [/thef t/g, 'theft'], [/thrif t/g, 'thrift'], [/dep th/g, 'depth'],
        [/fif th/g, 'fifth'], [/st ink/g, 'stink'], [/wr ink/g, 'wring'],
        [/slep/g, 'sleep'], [/shiep/g, 'sheep'], [/wep/g, 'weep']
      ];

      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        const corrected = CHAPTER_CONFIG.sentences.map(s => {
          let text = s;
          TYPO_CORRECTIONS.forEach(([pattern, replacement]) => {
            text = text.replace(pattern, replacement);
          });
          return text;
        });
        document.getElementById('sentences').innerHTML =
          corrected.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the 'ee' pattern!' :
              score >= 10 ? 'Review words like ‚Äúcheep‚Äù vs ‚Äúpeep.‚Äù' : 'Practice 'ee' words daily‚Äîtry spelling them aloud.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
