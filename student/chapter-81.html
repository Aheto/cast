<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 82: Vowel Team ee"/>
  <title>Mini OpenStax ‚Äî Lesson 82: Vowel Team ee</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 82: Vowel Team ee</h1>
        <div class="lo-tags" id="lo-tags">LO PH82: Decode and use words with the vowel team /ee/</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Practice reading words with the <strong>ee</strong> vowel team:</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const currentChapter = 81;
      const MAX_CHAPTER = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 82: Vowel Team ee",
        loTags: ["LO PH82: Decode and use words with the vowel team /ee/"],
        contentWords: ["see", "seed", "seek", "seem", "seen", "seep", "sheep", "sheet", "sheen", "sheer", "sneer", "sleep", "sleet", "sleek", "eel", "steel", "steep", "steer", "steed", "street", "speed", "speech", "spree", "screen", "screech", "sweep", "sweet"],
        sentences: ["The plum was fresh and sweet.", "The ranch had a flock of sheep.", "Jack will plant a seed in the pot.", "Did the speech seem long and dull?", "Bess will sleep on a bunk bed at camp.", "Bess had a quilt and a sheet on the bed.", "Mitch can steer the truck up the street.", "Mitch must not speed in the truck.", "Scott must sweep up the mess he left on the rug.", "Rick had a sleek steel sled. The sled can speed on a steep hill."],
        assessmentItems: [
          { id: "1", prompt: "Which word describes a metal made of iron and carbon?", options: [{id:"a",text:"steel",is_correct:true},{id:"b",text:"steep",is_correct:false},{id:"c",text:"steer",is_correct:false},{id:"d",text:"sheet",is_correct:false}]},
          { id: "2", prompt: "What did Jack plant in a pot?", options: [{id:"a",text:"A seed",is_correct:true},{id:"b",text:"A sheet",is_correct:false},{id:"c",text:"A sheep",is_correct:false},{id:"d",text:"A sweet",is_correct:false}]},
          { id: "3", prompt: "Which word means to move a vehicle?", options: [{id:"a",text:"steer",is_correct:true},{id:"b",text:"speed",is_correct:false},{id:"c",text:"sweep",is_correct:false},{id:"d",text:"sleep",is_correct:false}]},
          { id: "4", prompt: "What kind of animal lives on the ranch?", options: [{id:"a",text:"sheep",is_correct:true},{id:"b",text:"steed",is_correct:false},{id:"c",text:"eel",is_correct:false},{id:"d",text:"screen",is_correct:false}]},
          { id: "5", prompt: "Where did Bess sleep?", options: [{id:"a",text:"On a bunk bed",is_correct:true},{id:"b",text:"On a rug",is_correct:false},{id:"c",text:"In a truck",is_correct:false},{id:"d",text:"On a sled",is_correct:false}]},
          { id: "6", prompt: "Which word describes a very slanted hill?", options: [{id:"a",text:"steep",is_correct:true},{id:"b",text:"sleek",is_correct:false},{id:"c",text:"sweet",is_correct:false},{id:"d",text:"seen",is_correct:false}]},
          { id: "7", prompt: "What must Scott do with the mess?", options: [{id:"a",text:"sweep it up",is_correct:true},{id:"b",text:"seek it",is_correct:false},{id:"c",text:"speed past it",is_correct:false},{id:"d",text:"plant it",is_correct:false}]},
          { id: "8", prompt: "Which word describes the taste of the plum?", options: [{id:"a",text:"sweet",is_correct:true},{id:"b",text:"sleek",is_correct:false},{id:"c",text:"sheer",is_correct:false},{id:"d",text:"fresh",is_correct:false}]},
          { id: "9", prompt: "What was the sled made of?", options: [{id:"a",text:"steel",is_correct:true},{id:"b",text:"sheet",is_correct:false},{id:"c",text:"seed",is_correct:false},{id:"d",text:"rug",is_correct:false}]},
          { id: "10", prompt: "Which word means a formal talk?", options: [{id:"a",text:"speech",is_correct:true},{id:"b",text:"spree",is_correct:false},{id:"c",text:"sneer",is_correct:false},{id:"d",text:"sheen",is_correct:false}]},
          { id: "11", prompt: "What covers the bed along with a quilt?", options: [{id:"a",text:"A sheet",is_correct:true},{id:"b",text:"A screen",is_correct:false},{id:"c",text:"A seed",is_correct:false},{id:"d",text:"A street",is_correct:false}]},
          { id: "12", prompt: "Where does Mitch steer the truck?", options: [{id:"a",text:"Up the street",is_correct:true},{id:"b",text:"On the rug",is_correct:false},{id:"c",text:"In the pot",is_correct:false},{id:"d",text:"At camp",is_correct:false}]},
          { id: "13", prompt: "Which word means to look for?", options: [{id:"a",text:"seek",is_correct:true},{id:"b",text:"seen",is_correct:false},{id:"c",text:"seep",is_correct:false},{id:"d",text:"see",is_correct:false}]},
          { id: "14", prompt: "Which word describes a smooth and shiny surface?", options: [{id:"a",text:"sleek",is_correct:true},{id:"b",text:"steep",is_correct:false},{id:"c",text:"sweet",is_correct:false},{id:"d",text:"dull",is_correct:false}]},
          { id: "15", prompt: "What is a group of sheep called?", options: [{id:"a",text:"flock",is_correct:true},{id:"b",text:"spree",is_correct:false},{id:"c",text:"steed",is_correct:false},{id:"d",text:"mess",is_correct:false}]},
          { id: "16", prompt: "Which word means a loud, high cry?", options: [{id:"a",text:"screech",is_correct:true},{id:"b",text:"speech",is_correct:false},{id:"c",text:"screen",is_correct:false},{id:"d",text:"sweep",is_correct:false}]},
          { id: "17", prompt: "Mitch must NOT do what in the truck?", options: [{id:"a",text:"speed",is_correct:true},{id:"b",text:"steer",is_correct:false},{id:"c",text:"sleep",is_correct:false},{id:"d",text:"sweep",is_correct:false}]},
          { id: "18", prompt: "Which word means a horse?", options: [{id:"a",text:"steed",is_correct:true},{id:"b",text:"sheep",is_correct:false},{id:"c",text:"eel",is_correct:false},{id:"d",text:"seed",is_correct:false}]},
          { id: "19", prompt: "How did the speech seem?", options: [{id:"a",text:"long and dull",is_correct:true},{id:"b",text:"sweet and fresh",is_correct:false},{id:"c",text:"sleek and steel",is_correct:false},{id:"d",text:"fast and steep",is_correct:false}]},
          { id: "20", prompt: "Which word means 'to appear to be'?", options: [{id:"a",text:"seem",is_correct:true},{id:"b",text:"seen",is_correct:false},{id:"c",text:"seep",is_correct:false},{id:"d",text:"see",is_correct:false}]}
        ]
      };

      const TYPO_CORRECTIONS = [[/f resh/g, 'fresh'], [/p unch/g, 'punch'], [/slep t/g, 'slept'], [/crep t/g, 'crept'], [/p lant/g, 'plant'], [/p ath/g, 'path'], [/f roth/g, 'froth'], [/p eck/g, 'peck'], [/f luck/g, 'pluck'], [/p luck/g, 'pluck'], [/f ling/g, 'fling'], [/p ass/g, 'pass'], [/f uss/g, 'fuss'], [/sp ell/g, 'spell'], [/f uzz/g, 'fuzz'], [/thef t/g, 'theft'], [/thrif t/g, 'thrift'], [/dep th/g, 'depth'], [/fif th/g, 'fifth'], [/st ink/g, 'stink'], [/wr ink/g, 'wring']];

      function renderWords() {
        document.getElementById('word-list').innerHTML = CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        const corrected = CHAPTER_CONFIG.sentences.map(s => {
          let text = s;
          TYPO_CORRECTIONS.forEach(([pattern, replacement]) => { text = text.replace(pattern, replacement); });
          return text;
        });
        document.getElementById('sentences').innerHTML = corrected.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          if (c > MAX_CHAPTER) break;
          buttons.push({ label: `Lesson ${c + 1}`, url: `chapter-${c}.html`, active: i === 0 });
        }
        nav.innerHTML = buttons.map(b => `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);
        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;
          const optHtml = shuffledOpts.map((opt, idx) => `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${String.fromCharCode(65 + idx)}. ${opt.text}</label></div>`).join('');
          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];
        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          if (ans === correctId) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });
        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';
        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;
        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `<div class="feedback"><h3>üìä Results: ${score}/${total}</h3><p><strong>${mastery ? 'üéâ Excellent!' : 'Keep practicing.'}</strong></p><p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p><a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">üì≤ Send Report via WhatsApp</a></div>`;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) { alert("Please answer all questions."); return; }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');
        if (saved) {
          promptDiv.style.display = 'block'; quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `<button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button><button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>`;
          document.getElementById('keep-btn').onclick = () => { promptDiv.style.display = 'none'; quizDiv.style.display = 'block'; };
          document.getElementById('change-btn').onclick = () => { display.style.display = 'none'; input.style.display = 'block'; buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`; input.value = ''; input.focus(); document.getElementById('save-new').onclick = () => { const name = input.value.trim(); if (name) { localStorage.setItem('student_name', name); promptDiv.style.display = 'none'; quizDiv.style.display = 'block'; } }; };
        } else {
          promptDiv.style.display = 'block'; quizDiv.style.display = 'none'; input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = () => { const name = input.value.trim(); if (name) { localStorage.setItem('student_name', name); promptDiv.style.display = 'none'; quizDiv.style.display = 'block'; } };
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation(); renderWords(); renderSentences(); renderQuiz(); setupQuizListeners(); initNamePrompt();
      }
      if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); }
    })();
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 82: Vowel Team ee"/>
  <title>Mini OpenStax ‚Äî Lesson 82: Vowel Team ee</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 82: Vowel Team ee</h1>
        <div class="lo-tags" id="lo-tags">LO PH82: Decode and use words with the vowel team /ee/</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Practice reading words with the <strong>ee</strong> vowel team:</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const currentChapter = 81;
      const MAX_CHAPTER = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 82: Vowel Team ee",
        loTags: ["LO PH82: Decode and use words with the vowel team /ee/"],
        contentWords: ["see", "seed", "seek", "seem", "seen", "seep", "sheep", "sheet", "sheen", "sheer", "sneer", "sleep", "sleet", "sleek", "eel", "steel", "steep", "steer", "steed", "street", "speed", "speech", "spree", "screen", "screech", "sweep", "sweet"],
        sentences: ["The plum was fresh and sweet.", "The ranch had a flock of sheep.", "Jack will plant a seed in the pot.", "Did the speech seem long and dull?", "Bess will sleep on a bunk bed at camp.", "Bess had a quilt and a sheet on the bed.", "Mitch can steer the truck up the street.", "Mitch must not speed in the truck.", "Scott must sweep up the mess he left on the rug.", "Rick had a sleek steel sled. The sled can speed on a steep hill."],
        assessmentItems: [
          { id: "1", prompt: "Which word describes a metal made of iron and carbon?", options: [{id:"a",text:"steel",is_correct:true},{id:"b",text:"steep",is_correct:false},{id:"c",text:"steer",is_correct:false},{id:"d",text:"sheet",is_correct:false}]},
          { id: "2", prompt: "What did Jack plant in a pot?", options: [{id:"a",text:"A seed",is_correct:true},{id:"b",text:"A sheet",is_correct:false},{id:"c",text:"A sheep",is_correct:false},{id:"d",text:"A sweet",is_correct:false}]},
          { id: "3", prompt: "Which word means to move a vehicle?", options: [{id:"a",text:"steer",is_correct:true},{id:"b",text:"speed",is_correct:false},{id:"c",text:"sweep",is_correct:false},{id:"d",text:"sleep",is_correct:false}]},
          { id: "4", prompt: "What kind of animal lives on the ranch?", options: [{id:"a",text:"sheep",is_correct:true},{id:"b",text:"steed",is_correct:false},{id:"c",text:"eel",is_correct:false},{id:"d",text:"screen",is_correct:false}]},
          { id: "5", prompt: "Where did Bess sleep?", options: [{id:"a",text:"On a bunk bed",is_correct:true},{id:"b",text:"On a rug",is_correct:false},{id:"c",text:"In a truck",is_correct:false},{id:"d",text:"On a sled",is_correct:false}]},
          { id: "6", prompt: "Which word describes a very slanted hill?", options: [{id:"a",text:"steep",is_correct:true},{id:"b",text:"sleek",is_correct:false},{id:"c",text:"sweet",is_correct:false},{id:"d",text:"seen",is_correct:false}]},
          { id: "7", prompt: "What must Scott do with the mess?", options: [{id:"a",text:"sweep it up",is_correct:true},{id:"b",text:"seek it",is_correct:false},{id:"c",text:"speed past it",is_correct:false},{id:"d",text:"plant it",is_correct:false}]},
          { id: "8", prompt: "Which word describes the taste of the plum?", options: [{id:"a",text:"sweet",is_correct:true},{id:"b",text:"sleek",is_correct:false},{id:"c",text:"sheer",is_correct:false},{id:"d",text:"fresh",is_correct:false}]},
          { id: "9", prompt: "What was the sled made of?", options: [{id:"a",text:"steel",is_correct:true},{id:"b",text:"sheet",is_correct:false},{id:"c",text:"seed",is_correct:false},{id:"d",text:"rug",is_correct:false}]},
          { id: "10", prompt: "Which word means a formal talk?", options: [{id:"a",text:"speech",is_correct:true},{id:"b",text:"spree",is_correct:false},{id:"c",text:"sneer",is_correct:false},{id:"d",text:"sheen",is_correct:false}]},
          { id: "11", prompt: "What covers the bed along with a quilt?", options: [{id:"a",text:"A sheet",is_correct:true},{id:"b",text:"A screen",is_correct:false},{id:"c",text:"A seed",is_correct:false},{id:"d",text:"A street",is_correct:false}]},
          { id: "12", prompt: "Where does Mitch steer the truck?", options: [{id:"a",text:"Up the street",is_correct:true},{id:"b",text:"On the rug",is_correct:false},{id:"c",text:"In the pot",is_correct:false},{id:"d",text:"At camp",is_correct:false}]},
          { id: "13", prompt: "Which word means to look for?", options: [{id:"a",text:"seek",is_correct:true},{id:"b",text:"seen",is_correct:false},{id:"c",text:"seep",is_correct:false},{id:"d",text:"see",is_correct:false}]},
          { id: "14", prompt: "Which word describes a smooth and shiny surface?", options: [{id:"a",text:"sleek",is_correct:true},{id:"b",text:"steep",is_correct:false},{id:"c",text:"sweet",is_correct:false},{id:"d",text:"dull",is_correct:false}]},
          { id: "15", prompt: "What is a group of sheep called?", options: [{id:"a",text:"flock",is_correct:true},{id:"b",text:"spree",is_correct:false},{id:"c",text:"steed",is_correct:false},{id:"d",text:"mess",is_correct:false}]},
          { id: "16", prompt: "Which word means a loud, high cry?", options: [{id:"a",text:"screech",is_correct:true},{id:"b",text:"speech",is_correct:false},{id:"c",text:"screen",is_correct:false},{id:"d",text:"sweep",is_correct:false}]},
          { id: "17", prompt: "Mitch must NOT do what in the truck?", options: [{id:"a",text:"speed",is_correct:true},{id:"b",text:"steer",is_correct:false},{id:"c",text:"sleep",is_correct:false},{id:"d",text:"sweep",is_correct:false}]},
          { id: "18", prompt: "Which word means a horse?", options: [{id:"a",text:"steed",is_correct:true},{id:"b",text:"sheep",is_correct:false},{id:"c",text:"eel",is_correct:false},{id:"d",text:"seed",is_correct:false}]},
          { id: "19", prompt: "How did the speech seem?", options: [{id:"a",text:"long and dull",is_correct:true},{id:"b",text:"sweet and fresh",is_correct:false},{id:"c",text:"sleek and steel",is_correct:false},{id:"d",text:"fast and steep",is_correct:false}]},
          { id: "20", prompt: "Which word means 'to appear to be'?", options: [{id:"a",text:"seem",is_correct:true},{id:"b",text:"seen",is_correct:false},{id:"c",text:"seep",is_correct:false},{id:"d",text:"see",is_correct:false}]}
        ]
      };

      const TYPO_CORRECTIONS = [[/f resh/g, 'fresh'], [/p unch/g, 'punch'], [/slep t/g, 'slept'], [/crep t/g, 'crept'], [/p lant/g, 'plant'], [/p ath/g, 'path'], [/f roth/g, 'froth'], [/p eck/g, 'peck'], [/f luck/g, 'pluck'], [/p luck/g, 'pluck'], [/f ling/g, 'fling'], [/p ass/g, 'pass'], [/f uss/g, 'fuss'], [/sp ell/g, 'spell'], [/f uzz/g, 'fuzz'], [/thef t/g, 'theft'], [/thrif t/g, 'thrift'], [/dep th/g, 'depth'], [/fif th/g, 'fifth'], [/st ink/g, 'stink'], [/wr ink/g, 'wring']];

      function renderWords() {
        document.getElementById('word-list').innerHTML = CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        const corrected = CHAPTER_CONFIG.sentences.map(s => {
          let text = s;
          TYPO_CORRECTIONS.forEach(([pattern, replacement]) => { text = text.replace(pattern, replacement); });
          return text;
        });
        document.getElementById('sentences').innerHTML = corrected.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          if (c > MAX_CHAPTER) break;
          buttons.push({ label: `Lesson ${c + 1}`, url: `chapter-${c}.html`, active: i === 0 });
        }
        nav.innerHTML = buttons.map(b => `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);
        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;
          const optHtml = shuffledOpts.map((opt, idx) => `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${String.fromCharCode(65 + idx)}. ${opt.text}</label></div>`).join('');
          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];
        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          if (ans === correctId) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });
        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';
        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;
        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `<div class="feedback"><h3>üìä Results: ${score}/${total}</h3><p><strong>${mastery ? 'üéâ Excellent!' : 'Keep practicing.'}</strong></p><p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p><a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">üì≤ Send Report via WhatsApp</a></div>`;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) { alert("Please answer all questions."); return; }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');
        if (saved) {
          promptDiv.style.display = 'block'; quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `<button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button><button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>`;
          document.getElementById('keep-btn').onclick = () => { promptDiv.style.display = 'none'; quizDiv.style.display = 'block'; };
          document.getElementById('change-btn').onclick = () => { display.style.display = 'none'; input.style.display = 'block'; buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`; input.value = ''; input.focus(); document.getElementById('save-new').onclick = () => { const name = input.value.trim(); if (name) { localStorage.setItem('student_name', name); promptDiv.style.display = 'none'; quizDiv.style.display = 'block'; } }; };
        } else {
          promptDiv.style.display = 'block'; quizDiv.style.display = 'none'; input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = () => { const name = input.value.trim(); if (name) { localStorage.setItem('student_name', name); promptDiv.style.display = 'none'; quizDiv.style.display = 'block'; } };
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation(); renderWords(); renderSentences(); renderQuiz(); setupQuizListeners(); initNamePrompt();
      }
      if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); }
    })();
  </script>
</body>
</html>
