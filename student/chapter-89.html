<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 90: oo"/>
  <title>Mini OpenStax ‚Äî Lesson 90: oo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 90: oo</h1>
        <div class="lo-tags" id="lo-tags">LO PH090: Decode words with vowel team "oo" pronounced /oo/</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Words with "oo" that say /oo/ (as in <em>moon</em>):</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const currentChapter = 89;
      const MAX_CHAPTER = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 90: oo",
        loTags: ["LO PH090: Decode words with vowel team \"oo\" pronounced /oo/"],
        contentWords: [
          "soon", "scoop", "scoot", "shoo", "shoot", "sloop", "snoop", "spool", "spoof", "spook", "spoon", "stool", "stoop", "swoon", "swoop"
        ],
        sentences: [
          "The rat must scoot from the cat.",
          "Dean had a long string on a spool.",
          "The bus will soon be at the bus stop.",
          "Ross will stoop and pick up the mess on the rug.",
          "Mitch will snoop in the box and peek at the gift.",
          "Matt can stand on a stool and reach the top shelf.",
          "Neal can scoop up the cream in the dish with a spoon.",
          "Did a bee buzz and swoop at Nell? Did Nell shoo the bee?"
        ],
        assessmentItems: [
          { id: "1", prompt: "Which word has 'oo' that says /oo/ as in moon?", options: [
            {id:"a",text:"book",is_correct:false},
            {id:"b",text:"scoop",is_correct:true},
            {id:"c",text:"look",is_correct:false},
            {id:"d",text:"took",is_correct:false}
          ]},
          { id: "2", prompt: "Which word means 'to move quickly away'?", options: [
            {id:"a",text:"scoot",is_correct:true},
            {id:"b",text:"spool",is_correct:false},
            {id:"c",text:"stool",is_correct:false},
            {id:"d",text:"stoop",is_correct:false}
          ]},
          { id: "3", prompt: "Which word rhymes with 'moon'?", options: [
            {id:"a",text:"spoon",is_correct:true},
            {id:"b",text:"sun",is_correct:false},
            {id:"c",text:"man",is_correct:false},
            {id:"d",text:"run",is_correct:false}
          ]},
          { id: "4", prompt: "Which word is something you sit on?", options: [
            {id:"a",text:"stool",is_correct:true},
            {id:"b",text:"spool",is_correct:false},
            {id:"c",text:"scoop",is_correct:false},
            {id:"d",text:"sloop",is_correct:false}
          ]},
          { id: "5", prompt: "Which sentence uses a word with 'oo' = /oo/?", options: [
            {id:"a",text:"He ran fast.",is_correct:false},
            {id:"b",text:"The bus will soon arrive.",is_correct:true},
            {id:"c",text:"It is cold.",is_correct:false},
            {id:"d",text:"They played.",is_correct:false}
          ]},
          { id: "6", prompt: "Which word means 'to lower your body by bending your knees'?", options: [
            {id:"a",text:"stoop",is_correct:true},
            {id:"b",text:"swoop",is_correct:false},
            {id:"c",text:"shoot",is_correct:false},
            {id:"d",text:"snoop",is_correct:false}
          ]},
          { id: "7", prompt: "Which word describes a ghost trying to scare someone?", options: [
            {id:"a",text:"spook",is_correct:true},
            {id:"b",text:"spoof",is_correct:false},
            {id:"c",text:"sloop",is_correct:false},
            {id:"d",text:"scoop",is_correct:false}
          ]},
          { id: "8", prompt: "How is 'oo' pronounced in 'swoon'?", options: [
            {id:"a",text:"/≈≠/ as in 'book'",is_correct:false},
            {id:"b",text:"/oo/ as in 'moon'",is_correct:true},
            {id:"c",text:"/≈ç/ as in 'go'",is_correct:false},
            {id:"d",text:"/ƒÉ/ as in 'cat'",is_correct:false}
          ]},
          { id: "9", prompt: "Which word means 'to act sneakily or spy'?", options: [
            {id:"a",text:"snoop",is_correct:true},
            {id:"b",text:"scoot",is_correct:false},
            {id:"c",text:"shoot",is_correct:false},
            {id:"d",text:"shoo",is_correct:false}
          ]},
          { id: "10", prompt: "Which word comes FIRST alphabetically?", options: [
            {id:"a",text:"scoop",is_correct:true},
            {id:"b",text:"scoot",is_correct:false},
            {id:"c",text:"shoo",is_correct:false},
            {id:"d",text:"shoot",is_correct:false}
          ]},
          { id: "11", prompt: "Which word is a type of small ship?", options: [
            {id:"a",text:"sloop",is_correct:true},
            {id:"b",text:"spool",is_correct:false},
            {id:"c",text:"spoon",is_correct:false},
            {id:"d",text:"stool",is_correct:false}
          ]},
          { id: "12", prompt: "Which word is NOT in the word list?", options: [
            {id:"a",text:"spook",is_correct:false},
            {id:"b",text:"spoof",is_correct:false},
            {id:"c",text:"school",is_correct:true},
            {id:"d",text:"swoop",is_correct:false}
          ]},
          { id: "13", prompt: "In 'Did Nell shoo the bee?', what does 'shoo' mean?", options: [
            {id:"a",text:"to yell loudly",is_correct:false},
            {id:"b",text:"to chase away by saying 'shoo'",is_correct:true},
            {id:"c",text:"to pet gently",is_correct:false},
            {id:"d",text:"to feed",is_correct:false}
          ]},
          { id: "14", prompt: "Which word means 'a fake or joke imitation'?", options: [
            {id:"a",text:"spoof",is_correct:true},
            {id:"b",text:"spook",is_correct:false},
            {id:"c",text:"scoop",is_correct:false},
            {id:"d",text:"sloop",is_correct:false}
          ]},
          { id: "15", prompt: "Which word has the same vowel sound as 'moon'?", options: [
            {id:"a",text:"soon",is_correct:true},
            {id:"b",text:"good",is_correct:false},
            {id:"c",text:"foot",is_correct:false},
            {id:"d",text:"hood",is_correct:false}
          ]},
          { id: "16", prompt: "Which word ends with /p/ and has 'oo' = /oo/?", options: [
            {id:"a",text:"swoop",is_correct:true},
            {id:"b",text:"spoon",is_correct:false},
            {id:"c",text:"stool",is_correct:false},
            {id:"d",text:"spool",is_correct:false}
          ]},
          { id: "17", prompt: "What does 'swoon' mean?", options: [
            {id:"a",text:"to faint from emotion",is_correct:true},
            {id:"b",text:"to run fast",is_correct:false},
            {id:"c",text:"to shout",is_correct:false},
            {id:"d",text:"to jump",is_correct:false}
          ]},
          { id: "18", prompt: "Which word describes what you do to cream with a utensil?", options: [
            {id:"a",text:"scoop",is_correct:true},
            {id:"b",text:"shoot",is_correct:false},
            {id:"c",text:"snoop",is_correct:false},
            {id:"d",text:"stoop",is_correct:false}
          ]},
          { id: "19", prompt: "Which word is a homophone of 'shoot' (as in basketball)?", options: [
            {id:"a",text:"chute",is_correct:false},
            {id:"b",text:"none ‚Äî 'shoot' has no homophone in this list",is_correct:true},
            {id:"c",text:"shoe",is_correct:false},
            {id:"d",text:"suit",is_correct:false}
          ]},
          { id: "20", prompt: "Which word has 'oo' but does NOT say /oo/ (as in moon)?", options: [
            {id:"a",text:"book",is_correct:true},
            {id:"b",text:"spoon",is_correct:false},
            {id:"c",text:"swoop",is_correct:false},
            {id:"d",text:"soon",is_correct:false}
          ]}
        ]
      };

      const TYPO_CORRECTIONS = [
        [/f resh/g, 'fresh'], [/p unch/g, 'punch'], [/slep t/g, 'slept'],
        [/crep t/g, 'crept'], [/p lant/g, 'plant'], [/p ath/g, 'path'],
        [/f roth/g, 'froth'], [/p eck/g, 'peck'], [/f luck/g, 'pluck'],
        [/p luck/g, 'pluck'], [/f ling/g, 'fling'], [/p ass/g, 'pass'],
        [/f uss/g, 'fuss'], [/sp ell/g, 'spell'], [/f uzz/g, 'fuzz'],
        [/thef t/g, 'theft'], [/thrif t/g, 'thrift'], [/dep th/g, 'depth'],
        [/fif th/g, 'fifth'], [/st ink/g, 'stink'], [/wr ink/g, 'wring'],
        [/sp ool/g, 'spool'], [/sp oon/g, 'spoon'], [/p eel/g, 'peel'], [/f lea/g, 'flea'], [/p each/g, 'peach'], [/p eak/g, 'peak']
      ];

      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        const corrected = CHAPTER_CONFIG.sentences.map(s => {
          let text = s;
          TYPO_CORRECTIONS.forEach(([pattern, replacement]) => {
            text = text.replace(pattern, replacement);
          });
          return text;
        });
        document.getElementById('sentences').innerHTML =
          corrected.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
