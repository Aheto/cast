<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 158 ‚Äî Magic E Syllables (Long a)"/>
  <title>Mini OpenStax ‚Äî Lesson 158: Magic E (Long a)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn { background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-size: 1rem; }
    .btn:hover { background: #218838; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
    .correct { color: #28a745; }
    .incorrect { color: #dc3545; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 158: Magic E (Long a)</h1>
        <div class="lo-tags" id="lo-tags">LO PH158: Decode Magic E words where a = /ƒÅ/ with soft c and g</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Words featuring the <strong>Magic E</strong> pattern (Long a sound) with soft consonants:</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud. All words are decodable through Lesson 158:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div class="quiz" id="quiz-container">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';

      const currentChapter = 157;    // chapter-157.html = Lesson 158
      const maxChapter = 262;        

      const CHAPTER_CONFIG = {
        title: "Lesson 158: Magic E (Long a)",
        loTags: ["LO PH158: Decode Magic E words where a = /ƒÅ/ with soft c and g"],
        contentWords: [
          "ace", "face", "lace", "pace", "race", "brace", "grace", "trace", "place", "space", "age", "cage", "page", "rage", "wage", "stage"
        ],
        sentences: [
          "Grace is paid a wage each week.",
          "In the race, the leader set a fast pace.",
          "The animal at the zoo is kept in a cage.",
          "If Jake is absent, Jane will take his place.",
          "When she acted in the play, Grace had to get up on a stage.",
          "To do the magic trick, Roy must conceal an ace up his sleeve.",
          "Bill slipped on the wet lawn and fell face down on the grass.",
          "You should leave some blank space around the edge of a printed page."
        ],
        whatsappNumber: "233257320201",
        assessmentItems: [
          { id: "1", prompt: "In Magic E words ending in '-ace', what sound does the 'c' make?", options: [{id:"a",text:"/k/",is_correct:false},{id:"b",text:"/s/",is_correct:true},{id:"c",text:"/ch/",is_correct:false},{id:"d",text:"It is silent",is_correct:false}] },
          { id: "2", prompt: "What sound does the 'a' make in 'wage'?", options: [{id:"a",text:"Short a",is_correct:false},{id:"b",text:"Long a",is_correct:true},{id:"c",text:"/ah/",is_correct:false},{id:"d",text:"/aw/",is_correct:false}] },
          { id: "3", prompt: "How often is Grace paid her wage?", options: [{id:"a",text:"Each day",is_correct:false},{id:"b",text:"Each month",is_correct:false},{id:"c",text:"Each week",is_correct:true},{id:"d",text:"Once a year",is_correct:false}] },
          { id: "4", prompt: "Where is the animal at the zoo kept?", options: [{id:"a",text:"in a cage",is_correct:true},{id:"b",text:"on a stage",is_correct:false},{id:"c",text:"in a space",is_correct:false},{id:"d",text:"on a race",is_correct:false}] },
          { id: "5", prompt: "What did the leader set in the race?", options: [{id:"a",text:"a slow pace",is_correct:false},{id:"b",text:"a fast pace",is_correct:true},{id:"c",text:"a lace",is_correct:false},{id:"d",text:"a stage",is_correct:false}] },
          { id: "6", prompt: "Who will take Jake's place if he is absent?", options: [{id:"a",text:"Grace",is_correct:false},{id:"b",text:"Jane",is_correct:true},{id:"c",text:"Bill",is_correct:false},{id:"d",text:"Roy",is_correct:false}] },
          { id: "7", prompt: "What must Roy conceal up his sleeve for his trick?", options: [{id:"a",text:"a page",is_correct:false},{id:"b",text:"an ace",is_correct:true},{id:"c",text:"a lace",is_correct:false},{id:"d",text:"a wage",is_correct:false}] },
          { id: "8", prompt: "How did Bill fall on the grass?", options: [{id:"a",text:"side ways",is_correct:false},{id:"b",text:"backwards",is_correct:false},{id:"c",text:"face down",is_correct:true},{id:"d",text:"on his feet",is_correct:false}] },
          { id: "9", prompt: "Where should you leave blank space?", options: [{id:"a",text:"in a cage",is_correct:false},{id:"b",text:"on a stage",is_correct:false},{id:"c",text:"around the edge of a page",is_correct:true},{id:"d",text:"up your sleeve",is_correct:false}] },
          { id: "10", prompt: "Which word means a platform for performing?", options: [{id:"a",text:"stage",is_correct:true},{id:"b",text:"page",is_correct:false},{id:"c",text:"cage",is_correct:false},{id:"d",text:"wage",is_correct:false}] },
          { id: "11", prompt: "Which word rhymes with 'race'?", options: [{id:"a",text:"lace",is_correct:true},{id:"b",text:"rage",is_correct:false},{id:"c",text:"age",is_correct:false},{id:"d",text:"wage",is_correct:false}] },
          { id: "12", prompt: "In words like 'cage' and 'page', the 'g' makes which sound?", options: [{id:"a",text:"/g/ as in gate",is_correct:false},{id:"b",text:"/j/ as in jet",is_correct:true},{id:"c",text:"/s/ as in sun",is_correct:false},{id:"d",text:"It is silent",is_correct:false}] },
          { id: "13", prompt: "Which word means money earned for work?", options: [{id:"a",text:"wage",is_correct:true},{id:"b",text:"page",is_correct:false},{id:"c",text:"stage",is_correct:false},{id:"d",text:"cage",is_correct:false}] },
          { id: "14", prompt: "What happened to the lawn where Bill slipped?", options: [{id:"a",text:"It was dry",is_correct:false},{id:"b",text:"It was wet",is_correct:true},{id:"c",text:"It was cut",is_correct:false},{id:"d",text:"It was red",is_correct:false}] },
          { id: "15", prompt: "Which word means violent anger?", options: [{id:"a",text:"rage",is_correct:true},{id:"b",text:"race",is_correct:false},{id:"c",text:"page",is_correct:false},{id:"d",text:"ace",is_correct:false}] },
          { id: "16", prompt: "How many letters are in 'brace'?", options: [{id:"a",text:"4",is_correct:false},{id:"b",text:"5",is_correct:true},{id:"c",text:"6",is_correct:false},{id:"d",text:"3",is_correct:false}] },
          { id: "17", prompt: "Identify the long 'a' word: 'Jane will take his place.'", options: [{id:"a",text:"take",is_correct:true},{id:"b",text:"will",is_correct:false},{id:"c",text:"his",is_correct:false},{id:"d",text:"if",is_correct:false}] },
          { id: "18", prompt: "In Magic E syllables, which letter is usually silent?", options: [{id:"a",text:"the first vowel",is_correct:false},{id:"b",text:"the final 'e'",is_correct:true},{id:"c",text:"the consonant",is_correct:false},{id:"d",text:"none",is_correct:false}] },
          { id: "19", prompt: "What word means a string used to tie shoes?", options: [{id:"a",text:"lace",is_correct:true},{id:"b",text:"face",is_correct:false},{id:"c",text:"pace",is_correct:false},{id:"d",text:"brace",is_correct:false}] },
          { id: "20", prompt: "What did Grace have to do in the play?", options: [{id:"a",text:"run a race",is_correct:false},{id:"b",text:"get up on a stage",is_correct:true},{id:"c",text:"clean a cage",is_correct:false},{id:"d",text:"draw on a page",is_correct:false}] }
        ]
      };

      function renderWords() {
        const container = document.getElementById('word-list');
        container.innerHTML = CHAPTER_CONFIG.contentWords.map(word =>
          `<span class="word-item">${word}</span>`
        ).join('');
      }

      function renderSentences() {
        const container = document.getElementById('sentences');
        container.innerHTML = CHAPTER_CONFIG.sentences.map(s =>
          `<p>${s}</p>`
        ).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [];
        buttons.push({ label: "Home", url: "../index.html", active: false });
        for (let i = 0; i < 4; i++) {
          const chapterNum = currentChapter + i;
          if (chapterNum > maxChapter) break;
          const lessonNum = chapterNum + 1;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${chapterNum}.html`,
            active: (i === 0)
          });
        }
        nav.innerHTML = buttons.map(btn => `
          <a href="${btn.url}" class="chapter-btn ${btn.active ? 'active' : ''}">
            ${btn.label}
          </a>
        `).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => `
          <div class="question">
            <strong>${q.id}. ${q.prompt}</strong>
            <div class="options">
              ${q.options.map(opt => `
                <div class="option">
                  <label>
                    <input type="radio" name="q${q.id}" value="${opt.id}" required> ${opt.id.toUpperCase()}. ${opt.text}
                  </label>
                </div>
              `).join('')}
            </div>
          </div>
        `).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0;
        let correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const userAns = answers[i];
          const correctOpt = item.options.find(o => o.is_correct);
          const isCorrect = userAns === correctOpt.id;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt}\n   ‚úÖ Correct: ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt}\n   ‚ùå You chose: ${item.options.find(o => o.id === userAns)?.text || '‚Äî'}\n   ‚úÖ Correct: ${correctOpt.text}`);
          }
        });

        const score = `${correctCount}/20`;
        const summary = `*Mini OpenStax ‚Äî Phonics Lesson 158*\nStudent: [Name]\nScore: ${score}\n\n`;
        const correctStr = correctList.length ? '‚úÖ CORRECT:\n' + correctList.join('\n\n') + '\n\n' : '';
        const incorrectStr = incorrectList.length ? '‚ùå INCORRECT:\n' + incorrectList.join('\n\n') : '';
        const message = encodeURIComponent(summary + correctStr + incorrectStr + `\nReport generated via Mini OpenStax. Share with instructor: https://wa.me/${CHAPTER_CONFIG.whatsappNumber}`);
        const whatsappLink = `https://wa.me/${CHAPTER_CONFIG.whatsappNumber}?text=${message}`;

        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}</h3>
            <p><strong>${correctCount >= 15 ? 'Excellent! You‚Äôve mastered these Magic E words!' : correctCount >= 10 ? 'Good! Review missed items.' : 'Practice Lesson 158 words again.'}</strong></p>
            <p><a href="${whatsappLink}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">üì≤ Send Report to Instructor</a></p>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const selected = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(selected ? selected.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
