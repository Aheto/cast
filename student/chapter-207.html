<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 208: ei = /ƒÅ/ (veil, vein, rein, reindeer)"/>
  <title>Mini OpenStax ‚Äî Lesson 208: ei = /ƒÅ/ (veil, vein, rein, reindeer)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 208: ei = /ƒÅ/ (veil, vein, rein, reindeer)</h1>
        <div class="lo-tags" id="lo-tags">LO PH208: Decode words with 'ei' spelling for long a (/ƒÅ/)</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Words where 'ei' spells the long a sound (/ƒÅ/):</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const currentChapter = 207; // Lesson 208
      const MAX_CHAPTER = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 208: ei = /ƒÅ/ (veil, vein, rein, reindeer)",
        loTags: ["LO PH208: Decode words with 'ei' spelling for long a (/ƒÅ/)"],
        contentWords: [
          "veil", "vein", "rein", "reindeer", "freight", "eight", "weigh", "neighbor"
        ],
        sentences: [
          "The bride wore a white dress and a delicate veil.",
          "A vein is a blood vessel that carries blood to the heart.",
          "Santa's sleigh is pulled by eight reindeer.",
          "Please hold the reins tightly when you ride the horse.",
          "The doctor checked the vein in her arm before drawing blood.",
          "In the story, the reindeer helped Santa deliver presents."
        ],
        assessmentItems: [
          { id: "1", prompt: "Which word means 'a thin piece of fabric worn over the face or head'?", options: [
            {id:"a",text:"veil",is_correct:true},
            {id:"b",text:"vein",is_correct:false},
            {id:"c",text:"rein",is_correct:false},
            {id:"d",text:"reindeer",is_correct:false}
          ]},
          { id: "2", prompt: "Which word refers to a blood vessel?", options: [
            {id:"a",text:"vein",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"rein",is_correct:false},
            {id:"d",text:"freight",is_correct:false}
          ]},
          { id: "3", prompt: "What are 'reins'?", options: [
            {id:"a",text:"Straps used to control a horse",is_correct:true},
            {id:"b",text:"Types of deer",is_correct:false},
            {id:"c",text:"Head coverings",is_correct:false},
            {id:"d",text:"Blood vessels",is_correct:false}
          ]},
          { id: "4", prompt: "Which sentence uses a word with 'ei = /ƒÅ/' correctly?", options: [
            {id:"a",text:"She wore a veil.",is_correct:true},
            {id:"b",text:"He veiled the horse.",is_correct:false},
            {id:"c",text:"They reined the blood.",is_correct:false},
            {id:"d",text:"We veined the sleigh.",is_correct:false}
          ]},
          { id: "5", prompt: "Which word refers to the animal associated with Santa Claus?", options: [
            {id:"a",text:"reindeer",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"vein",is_correct:false},
            {id:"d",text:"rein",is_correct:false}
          ]},
          { id: "6", prompt: "Which word contains 'ei' but does NOT say /ƒÅ/?", options: [
            {id:"a",text:"receive",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"vein",is_correct:false},
            {id:"d",text:"rein",is_correct:false}
          ]},
          { id: "7", prompt: "What does 'freight' mean in this lesson‚Äôs context?", options: [
            {id:"a",text:"Cargo (also uses 'eigh = /ƒÅ/')",is_correct:true},
            {id:"b",text:"A type of rein",is_correct:false},
            {id:"c",text:"A facial covering",is_correct:false},
            {id:"d",text:"A blood vessel",is_correct:false}
          ]},
          { id: "8", prompt: "Which word is NOT primarily taught in this lesson (though it contains /ƒÅ/)?", options: [
            {id:"a",text:"neighbor",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"vein",is_correct:false},
            {id:"d",text:"reindeer",is_correct:false}
          ]},
          { id: "9", prompt: "In the sentence 'The reindeer pulled the sleigh,' how many words have 'ei = /ƒÅ/'?", options: [
            {id:"a",text:"One",is_correct:true},
            {id:"b",text:"Two",is_correct:false},
            {id:"c",text:"Three",is_correct:false},
            {id:"d",text:"None",is_correct:false}
          ]},
          { id: "10", prompt: "Which word means 'to hold back or control' (as in horses)?", options: [
            {id:"a",text:"rein",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"vein",is_correct:false},
            {id:"d",text:"freight",is_correct:false}
          ]},
          { id: "11", prompt: "What sound does 'ei' make in 'veil'?", options: [
            {id:"a",text:"/ƒÅ/",is_correct:true},
            {id:"b",text:"/v/",is_correct:false},
            {id:"c",text:"/ƒï/",is_correct:false},
            {id:"d",text:"/ƒ≠/",is_correct:false}
          ]},
          { id: "12", prompt: "Which word appears in medical contexts?", options: [
            {id:"a",text:"vein",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"rein",is_correct:false},
            {id:"d",text:"reindeer",is_correct:false}
          ]},
          { id: "13", prompt: "Which word is part of 'Santa‚Äôs reindeer'?", options: [
            {id:"a",text:"reindeer",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"vein",is_correct:false},
            {id:"d",text:"freight",is_correct:false}
          ]},
          { id: "14", prompt: "Which word demonstrates that 'ei = /ƒÅ/' often appears after consonants like 'v', 'r', or 'n'?", options: [
            {id:"a",text:"veil, rein, vein",is_correct:true},
            {id:"b",text:"only reindeer",is_correct:false},
            {id:"c",text:"only freight",is_correct:false},
            {id:"d",text:"receive",is_correct:false}
          ]},
          { id: "15", prompt: "How is 'ei' pronounced in 'reindeer'?", options: [
            {id:"a",text:"/ƒÅ/",is_correct:true},
            {id:"b",text:"/r/",is_correct:false},
            {id:"c",text:"/ƒï/",is_correct:false},
            {id:"d",text:"/d/",is_correct:false}
          ]},
          { id: "16", prompt: "Which word is used in 'pull in the reins'?", options: [
            {id:"a",text:"rein",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"vein",is_correct:false},
            {id:"d",text:"eight",is_correct:false}
          ]},
          { id: "17", prompt: "Which word shows that 'ei = /ƒÅ/' appears in both everyday and seasonal vocabulary?", options: [
            {id:"a",text:"reindeer (seasonal), vein (everyday)",is_correct:true},
            {id:"b",text:"only veil",is_correct:false},
            {id:"c",text:"only freight",is_correct:false},
            {id:"d",text:"neighbor",is_correct:false}
          ]},
          { id: "18", prompt: "Which word is a homophone of 'vail' (an archaic word for 'lower')?", options: [
            {id:"a",text:"veil",is_correct:true},
            {id:"b",text:"vein",is_correct:false},
            {id:"c",text:"rein",is_correct:false},
            {id:"d",text:"reindeer",is_correct:false}
          ]},
          { id: "19", prompt: "Which word contrasts with 'artery' in the circulatory system?", options: [
            {id:"a",text:"vein",is_correct:true},
            {id:"b",text:"veil",is_correct:false},
            {id:"c",text:"rein",is_correct:false},
            {id:"d",text:"freight",is_correct:false}
          ]},
          { id: "20", prompt: "Which word illustrates that 'ei = /ƒÅ/' is a less common but consistent pattern distinct from 'ei = /ƒì/' (as in 'receive')?", options: [
            {id:"a",text:"veil vs. receive",is_correct:true},
            {id:"b",text:"only rein",is_correct:false},
            {id:"c",text:"only eight",is_correct:false},
            {id:"d",text:"neighbor",is_correct:false}
          ]}
        ]
      };

      const TYPO_CORRECTIONS = [
        [/f resh/g, 'fresh'], [/p unch/g, 'punch'], [/slep t/g, 'slept'],
        [/crep t/g, 'crept'], [/p lant/g, 'plant'], [/p ath/g, 'path'],
        [/f roth/g, 'froth'], [/p eck/g, 'peck'], [/f luck/g, 'pluck'],
        [/p luck/g, 'pluck'], [/f ling/g, 'fling'], [/p ass/g, 'pass'],
        [/f uss/g, 'fuss'], [/sp ell/g, 'spell'], [/f uzz/g, 'fuzz'],
        [/thef t/g, 'theft'], [/thrif t/g, 'thrift'], [/dep th/g, 'depth'],
        [/fif th/g, 'fifth'], [/st ink/g, 'stink'], [/wr ink/g, 'wring'],
        [/typ e/g, 'type'], [/f our/g, 'four'], [/f lies/g, 'flies'],
        [/emp tired/g, 'emptied'], [/p ennies/g, 'pennies'], [/f ourth/g, 'fourth'],
        [/f ried/g, 'fried'], [/multip ly/g, 'multiply'], [/f lying/g, 'flying'],
        [/p our/g, 'pour'], [/sh oulder/g, 'shoulder'], [/b oulder/g, 'boulder'],
        [/k now/g, 'know'], [/gr ow/g, 'grow'], [/sn ow/g, 'snow'],
        [/tom orrow/g, 'tomorrow'], [/yell ow/g, 'yellow'], [/wind ow/g, 'window'],
        [/fl our/g, 'flour'], [/h onor/g, 'honor'], [/l abor/g, 'labor'],
        [/mar igold/g, 'marigold'], [/thresh old/g, 'threshold'], [/be hold/g, 'behold'],
        [/f ellow/g, 'fellow'], [/newsp ap er/g, 'newspaper'],
        [/f ruit/g, 'fruit'], [/j uicy/g, 'juicy'], [/f reight/g, 'freight'],
        [/chicken s oup/g, 'chicken soup'], [/y outh g roup/g, 'youth group'],
        [/s leigh/g, 'sleigh'], [/e ight/g, 'eight'], [/n eighbor/g, 'neighbor'],
        [/v eil/g, 'veil'], [/v ein/g, 'vein'], [/r ein/g, 'rein']
      ];

      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        const corrected = CHAPTER_CONFIG.sentences.map(s => {
          let text = s;
          TYPO_CORRECTIONS.forEach(([pattern, replacement]) => {
            text = text.replace(pattern, replacement);
          });
          return text;
        });
        document.getElementById('sentences').innerHTML =
          corrected.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};

        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
