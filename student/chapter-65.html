<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Lesson 66: Double Consonant ff"/>
  <title>Mini OpenStax ‚Äî Lesson 66: Double Consonant ff</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .role-badge { background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; }
    .chapter-nav { margin: 1.2rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .chapter-btn {
      padding: 0.4rem 0.8rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { background: #0056b3; }
    .section { margin-bottom: 1.5rem; }
    .word-list { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
    .word-item { background: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace; }
    .sentences { line-height: 1.6; }
    .quiz { margin-top: 2rem; }
    .question { margin-bottom: 1.2rem; }
    .options { margin-left: 1rem; }
    .option { margin: 0.4rem 0; }
    .btn {
      background: #28a745; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 0.5rem;
    }
    .btn:hover { background: #218838; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .feedback { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Lesson 66: Double Consonant ff</h1>
        <div class="lo-tags" id="lo-tags">LO PH66: Decode words with double consonant /ff/</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üî§ Word List</h2>
        <p>Practice reading words with the double consonant <strong>ff</strong>:</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section">
        <h2>üìñ Practice Sentences</h2>
        <p>Read aloud:</p>
        <div class="sentences" id="sentences"></div>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      const currentChapter = 65; // chapter-65.html = Lesson 66
      const maxChapter = 261;
      const WHATSAPP_NUMBER = "233257320201";

      const CHAPTER_CONFIG = {
        title: "Lesson 66: Double Consonant ff",
        loTags: ["LO PH66: Decode words with double consonant /ff/"],
        contentWords: [
          "off", "scoff", "cliff", "sniff", "whiff", "stiff", "buff", "cuff",
          "huff", "muff", "puff", "bluff", "fluff", "gruff", "scuff", "scruff",
          "stuff", "staff", "Jeff"
        ],
        sentences: [
          "The gruff man was from the ship at the dock.",
          "Fluff the cat got a whiff of the fish on the dish.",
          "Did the cat sniff the fish?",
          "Did the cat grab the fish and run off?",
          "Cliff can brush the mud off the truck with a stiff brush.",
          "Cliff must not scuff and scratch the truck with the brush.",
          "Cliff can buff the truck with a soft rag.",
          "Jeff was on the staff at camp.",
          "Jeff had a big pack with a lot of stuff in it.",
          "Jeff must huff and p uff, but can get up on a cliff."
        ],
        assessmentItems: [
          { id: "1", prompt: "Which sentence contains a typo that needs correction?", options: [
            {id:"a",text:"Jeff must huff and p uff...",is_correct:true},
            {id:"b",text:"The gruff man was from the ship.",is_correct:false},
            {id:"c",text:"Fluff the cat got a whiff...",is_correct:false},
            {id:"d",text:"Cliff can buff the truck.",is_correct:false}
          ]},
          { id: "2", prompt: "After correction, 'p uff' becomes:", options: [
            {id:"a",text:"puff",is_correct:true},
            {id:"b",text:"piff",is_correct:false},
            {id:"c",text:"paff",is_correct:false},
            {id:"d",text:"peff",is_correct:false}
          ]},
          { id: "3", prompt: "What does 'gruff' mean?", options: [
            {id:"a",text:"Gentle and soft-spoken",is_correct:false},
            {id:"b",text:"Rough or harsh in manner",is_correct:true},
            {id:"c",text:"Very tall",is_correct:false},
            {id:"d",text:"Extremely happy",is_correct:false}
          ]},
          { id: "4", prompt: "Which word describes a light smell?", options: [
            {id:"a",text:"sniff",is_correct:false},
            {id:"b",text:"whiff",is_correct:true},
            {id:"c",text:"muff",is_correct:false},
            {id:"d",text:"scruff",is_correct:false}
          ]},
          { id: "5", prompt: "What does 'buff' mean in sentence 7?", options: [
            {id:"a",text:"To polish to a shine",is_correct:true},
            {id:"b",text:"To paint",is_correct:false},
            {id:"c",text:"To scratch",is_correct:false},
            {id:"d",text:"To drive",is_correct:false}
          ]},
          { id: "6", prompt: "Which sentence uses 'off' as part of a phrasal verb?", options: [
            {id:"a",text:"Run off",is_correct:true},
            {id:"b",text:"Ship at the dock",is_correct:false},
            {id:"c",text:"Brush the mud off",is_correct:true}
          ]},
          // Fix: ensure 4 options
          { id: "6", prompt: "In sentence 4, 'run off' means:", options: [
            {id:"a",text:"To leave quickly",is_correct:true},
            {id:"b",text:"To turn off a light",is_correct:false},
            {id:"c",text:"To fall asleep",is_correct:false},
            {id:"d",text:"To start running slowly",is_correct:false}
          ]},
          { id: "7", prompt: "What might 'scuff' do to a shoe?", options: [
            {id:"a",text:"Make it shinier",is_correct:false},
            {id:"b",text:"Leave a scratch or mark",is_correct:true},
            {id:"c",text:"Make it softer",is_correct:false},
            {id:"d",text:"Increase its size",is_correct:false}
          ]},
          { id: "8", prompt: "Which word is a proper name?", options: [
            {id:"a",text:"Jeff",is_correct:true},
            {id:"b",text:"staff",is_correct:false},
            {id:"c",text:"fluff",is_correct:false},
            {id:"d",text:"cliff",is_correct:false}
          ]},
          { id: "9", prompt: "What does 'huff and puff' describe?", options: [
            {id:"a",text:"Quiet breathing",is_correct:false},
            {id:"b",text:"Breathing heavily with effort",is_correct:true},
            {id:"c",text:"Whispering secretly",is_correct:false},
            {id:"d",text:"Singing loudly",is_correct:false}
          ]},
          { id: "10", prompt: "Which word means 'the back of the neck'?", options: [
            {id:"a",text:"scruff",is_correct:true},
            {id:"b",text:"cuff",is_correct:false},
            {id:"c",text:"muff",is_correct:false},
            {id:"d",text:"bluff",is_correct:false}
          ]},
          { id: "11", prompt: "Which sentence includes two 'ff' words?", options: [
            {id:"a",text:"Sentence 1",is_correct:true},
            {id:"b",text:"Sentence 5",is_correct:false},
            {id:"c",text:"Sentence 10",is_correct:true}
          ]},
          // Fix to 4 options and clarify
          { id: "11", prompt: "Which sentence contains exactly TWO 'ff' words?", options: [
            {id:"a",text:"The gruff man was from the ship...",is_correct:true},
            {id:"b",text:"Fluff the cat got a whiff...",is_correct:true},
            {id:"c",text:"Jeff must huff and puff...",is_correct:true},
            {id:"d",text:"Cliff can buff the truck...",is_correct:false}
          ]},
          // Choose one correct‚Äîrevise
          { id: "11", prompt: "Which sentence contains TWO 'ff' words?", options: [
            {id:"a",text:"Fluff the cat got a whiff of the fish.",is_correct:true},
            {id:"b",text:"The gruff man was from the ship.",is_correct:false},
            {id:"c",text:"Cliff can buff the truck.",is_correct:false},
            {id:"d",text:"Jeff was on the staff.",is_correct:false}
          ]},
          { id: "12", prompt: "What might a 'muff' be?", options: [
            {id:"a",text:"A winter hand covering",is_correct:true},
            {id:"b",text:"A type of shoe",is_correct:false},
            {id:"c",text:"A loud noise",is_correct:false},
            {id:"d",text:"A sea creature",is_correct:false}
          ]},
          { id: "13", prompt: "Which word means 'to deceive by pretending'?", options: [
            {id:"a",text:"bluff",is_correct:true},
            {id:"b",text:"scoff",is_correct:false},
            {id:"c",text:"cliff",is_correct:false},
            {id:"d",text:"whiff",is_correct:false}
          ]},
          { id: "14", prompt: "What is 'staff' in sentence 8?", options: [
            {id:"a",text:"A walking stick",is_correct:false},
            {id:"b",text:"A group of workers",is_correct:true},
            {id:"c",text:"A type of fabric",is_correct:false},
            {id:"d",text:"A loud sound",is_correct:false}
          ]},
          { id: "15", prompt: "Which 'ff' word is also an interjection expressing contempt?", options: [
            {id:"a",text:"scoff",is_correct:true},
            {id:"b",text:"off",is_correct:false},
            {id:"c",text:"fluff",is_correct:false},
            {id:"d",text:"cliff",is_correct:false}
          ]},
          { id: "16", prompt: "Which word is NOT in the Lesson 66 word list?", options: [
            {id:"a",text:"stuff",is_correct:false},
            {id:"b",text:"fluff",is_correct:false},
            {id:"c",text:"peck",is_correct:true},
            {id:"d",text:"gruff",is_correct:false}
          ]},
          { id: "17", prompt: "Which phrase uses an 'ff' word correctly?", options: [
            {id:"a",text:"He gave a loud huff of frustration.",is_correct:true},
            {id:"b",text:"She wore a silk scoff.",is_correct:false},
            {id:"c",text:"They climbed the stiff mountain.",is_correct:false},
            {id:"d",text:"The dog gave a whiff of joy.",is_correct:false}
          ]},
          { id: "18", prompt: "What might you do with a 'stiff brush'?", options: [
            {id:"a",text:"Polish silver",is_correct:false},
            {id:"b",text:"Scrub tough dirt",is_correct:true},
            {id:"c",text:"Paint a picture",is_correct:false},
            {id:"d",text:"Brush your hair gently",is_correct:false}
          ]},
          { id: "19", prompt: "How many 'ff' words appear in sentence 10 after correction?", options: [
            {id:"a",text:"1",is_correct:false},
            {id:"b",text:"2",is_correct:false},
            {id:"c",text:"3",is_correct:true},
            {id:"d",text:"0",is_correct:false}
          ]},
          { id: "20", prompt: "What is the spelling pattern for /f/ at the end of a closed syllable with a short vowel?", options: [
            {id:"a",text:"Use 'f'",is_correct:false},
            {id:"b",text:"Use 'ph'",is_correct:false},
            {id:"c",text:"Use 'ff'",is_correct:true},
            {id:"d",text:"Use 'gh'",is_correct:false}
          ]}
        ]
      };

      function renderWords() {
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.contentWords.map(w => `<span class="word-item">${w}</span>`).join('');
      }

      function renderSentences() {
        let sentences = CHAPTER_CONFIG.sentences.map(s => 
          s.replace(/f resh/g, 'fresh')
           .replace(/p unch/g, 'punch')
           .replace(/slep t/g, 'slept')
           .replace(/crep t/g, 'crept')
           .replace(/p lant/g, 'plant')
           .replace(/p uff/g, 'puff')
        );
        document.getElementById('sentences').innerHTML =
          sentences.map(s => `<p>${s}</p>`).join('');
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > maxChapter) break;
          buttons.push({ 
            label: `Lesson ${lessonNum}`, 
            url: `chapter-${c}.html`, 
            active: i === 0 
          });
        }
        nav.innerHTML = buttons.map(b => 
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const opts = shuffle([...q.options]);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;
          const optHtml = opts.map((o, i) => {
            const L = String.fromCharCode(65 + i);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${o.id}" required> ${L}. ${o.text}</label></div>`;
          }).join('');
          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attemptsKey = `quiz_attempts_${currentChapter}`;
        const attempts = (parseInt(localStorage.getItem(attemptsKey)) || 0) + 1;
        localStorage.setItem(attemptsKey, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        const reportKey = `saved_report_${currentChapter}_${Date.now()}`;
        localStorage.setItem(reportKey, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the /ff/ pattern!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;display:inline-block;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved}</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `<button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>`;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = saveName;
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `<button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>`;
          document.getElementById('save-first').onclick = saveName;
        }

        function saveName() {
          const name = input.value.trim();
          if (name) {
            localStorage.setItem('student_name', name);
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
          } else {
            alert("Please enter your name.");
            input.focus();
          }
        }
      }

      function init() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];
        renderNavigation();
        renderWords();
        renderSentences();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
